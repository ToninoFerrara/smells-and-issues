repository,state,title,label,body
mosmetro-android/mosmetro-android,closed,Fix typo,[],
mosmetro-android/mosmetro-android,open,Oreo adaptive icon shape,[],"Please add support for icon shape
https://developer.android.com/guide/practices/ui_guidelines/icon_design_adaptive
https://material.io/guidelines/style/icons.html

you should fix it to upload new version to google play
https://www.xda-developers.com/google-play-app-updates-must-target-android-8-0/"
mosmetro-android/mosmetro-android,open,DNS over HTTPS,[],"Добрый день.
Я использую приложение для направления DNS трафика на серверы CloudFlare через HTTPS ([Infra](https://play.google.com/store/apps/details?id=app.intra)).
Приложение MosMetro обращается к фиксированным адресам для проверки подключения и эта проверка не завершается успешно.
```
[+0004] Название алгоритма: MosMetroV2
[+0001] Проверка доступа в интернет
[+0035] java.net.UnknownHostException: Unable to resolve host ""mt1.google.com"": No address associated with hostname
[+0000] OkHttp (111918427) | Retrying request (try 1 out of 6)
[+1006] java.net.UnknownHostException: Unable to resolve host ""mt1.google.com"": No address associated with hostname
[+0000] OkHttp (111918427) | Retrying request (try 2 out of 6)

```
Подключение при этом уже успешно установлено и оно разрывается при достижении лимита на количество проверок.
Можно ли в настройках ввести поле указания адреса для проверки подключения?"
mosmetro-android/mosmetro-android,open,Обновлённый Material Design,[],"Здравствуйте! Сделайте дизайн приложения в обновлённги Material Design. https://material.io

Примеры приложений с обновлённым дизайном: Google Fit, Google Календарь, Google Контакты, Android Сообщения, Solid Explorer, Google Новости."
mosmetro-android/mosmetro-android,open,WiFi в МАИ,[],"В МАИ есть бесплатная сеть MAInet_public 
Логин MAI
Пароль 1930"
mosmetro-android/mosmetro-android,open,Не работает алгоритм MosMetroV2WV,[],"Лог авторизации:
[+>10s] CachedRetriever (1116439816) | java.lang.Exception: Invalid URL: <HTML><HEAD><TITLE> Web Authentication Redirect</TITLE><META http-equiv=""Cache-control"" content=""no-cache""><META http-equiv=""Pragma"" content=""no-cache""><META http-equiv=""Expires"" content=""-1""><META http-equiv=""refresh"" content=""1; URL=http://welcome.wi-fi.ru/?client_mac=88-70-8c-93-b8-df&redirect=https://mosmetro-android.github.io/base-url""></HEAD></HTML>
[+0098] CachedRetriever (1116439816) | Unexpected character (<) at position 0.
[+1785] ConnectionService (1115729592) | Started from DebugActivity
[+0010] ConnectionService (1115729592) | Broadcast | ConnectionService (RUNNING = true)
[+0003] >>> Sep 29, 2018 9:26:38 AM
[+0000] Version: webview #40
[+0000] Connecting to MT_FREE
[+0001] Detecting the provider…
[+0004] Provider | generate_204() | URL: http://mt2.google.com/generate_204
[+0047] Algorithm name: MosMetroV3
[+0000] Checking Internet connection
[+0044] http://welcome.wi-fi.ru/?client_mac=88-70-8c-93-b8-df
[+0000] Getting login page
[+0088] <!doctype html>
<html class=""no-js"">
 <head>
  <meta charset=""utf-8"">
  <meta content=""text/html; charset=UTF-8"" http-equiv=""Content-Type"">
  <meta content=""no-cache,no-store,must-revalidate"" http-equiv=""Cache-Control"">
  <meta content=""no-cache"" http-equiv=""Pragma"">
  <meta content=""-1"" http-equiv=""Expires"">
  <meta content=""noindex, nofollow"" name=""robots"">
  <meta content=""always"" name=""referrer"">
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link href=""/favicon.ico"" rel=""icon"" type=""image/x-icon"">
  <link href=""/favicon.ico"" rel=""shortcut icon"" type=""image/x-icon"">
  <link href=""ios11/css/style.css"" rel=""stylesheet"">
  <title>Авторизация Wi-Fi</title>
  <meta content=""АО «МаксимаТелеком»"" name=""author"">
  <meta name=""csrf-param"" content=""authenticity_token""> 
  <meta name=""csrf-token"" content=""SXiMQcZEjy7H/cp4Ad4of3gFE7cGgNKrkXLGHV0jdqHUAI6KpWISTwWP8HKcQ/zkaeUMHiBbsUf56YXnx4Hd/Q=="">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/application_new-90b63faf5f9407a457930494821b17a330d9408edc3ef52d5a2af26a61749a50.css"">
  <script>window.user_mac = '88-70-8c-93-b8-df';
window.rootObjName = ""welcome.wi-fi.ru/pages/index"";</script>
 </head>
 <body id=""bd"">
  <script src=""https://mc.yandex.ru/metrika/watch.js"" type=""text/javascript""></script>
  <script>try {
    window.yaCounter49630984 = new Ya.Metrika({
        id: 49630984,
        clickmap: true,
        trackLinks: true,
        accurateTrackBounce: true,
        trackHash: true
    });
} catch (e) {}</script>
  <div class=""loading"" id=""ld"">
   <div class=""loading-spinner"">
    <div class=""centered"" id=""loader""></div>
   </div>
   <div class=""loading-text"" id=""load_text"">
    loading...
    <br> please, wait
   </div>
  </div>
  <div class=""captive-wrapper"" id=""cp"" style=""opacity:0;"">
   <div class=""captive-wrapper__header"" id=""hd"">
    Приветствуем вас
    <br>в Wi-Fi сети MT_FREE
   </div>
   <div class=""captive-wrapper__main"" id=""mn"">
    <a class=""captive-wrapper__main-link"" href=""//gowifi.ru"">Войти в интернет</a>
   </div>
   <div class=""captive-wrapper__footer"" id=""ft"">
    Для продолжения подключения
    <br>перейдите по ссылке —
    <a class=""captive-wrapper__footer-link"" href=""//gowifi.ru""> gowifi.ru</a>
   </div>
  </div>
  <div id=""root"">
   <div class=""loading"" id=""loader_holder"">
    <div class=""loading-spinner"">
     <div class=""centered"" id=""loader""></div>
    </div>
    <div class=""loading-text"" id=""load_text"">
     loading...
     <br>please, wait
    </div>
   </div>
   <div id=""error"">
    <header class=""welcome"">
     <p class=""welcome_text"">Приветствуем вас<br>в Wi‑Fi&nbsp;сети MT_FREE<span class=""welcome_text_code"">#118</span></p>
     <img class=""top_shape"" src=""data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NDEuODUgMTE4Ljg3Ij48ZyBkYXRhLW5hbWU9ItCh0LvQvtC5IDIiPjxwYXRoIGQ9Ik0wIDBoNjQxLjg1djY4LjI0UzUyOSAxMTguODcgMzIwLjkzIDExOC44NyAwIDY4LjI0IDAgNjguMjR6IiBmaWxsPSIjZDRkNGQ0IiBkYXRhLW5hbWU9ItCh0LvQvtC5IDEiLz48L2c+PC9zdmc+"">
    </header>
    <a class=""button_try_again"" data-objeventtype=""retry"" data-objname=""error_retry"" href=""/"" onclick=""refresh(event);"">Повторить</a>
    <p id=""error-text""></p>
    <footer class=""footer"">
     <p class=""footer_text""><span class=""footer_text_recommend"">Для входа в интернет рекомендуем</span><br>перейти на&nbsp;<a class=""footer_link"" href=""//gowifi.ru"">gowifi.ru</a></p>
     <img class=""footer_dog"" src=""//static.wi-fi.ru/static/captive/pages/errors/118/dogpic.jpg"">
    </footer>
   </div>
  </div>
  <script>window.locale = 'ru';</script>
  <script src=""//cstream.wi-fi.ru/divolte.js""></script>
  <script src=""/assets/application-9fe004695a360ac7f565cd27647cf671ddb1c9392c5c05cc5e791faf15bae572.js""></script>
  <script src=""/assets/divolte_kserks-5c104975edf98660789d732f80ac2a6a75c31e914675e2cc46d1d773fd344b37.js""></script>
  <script>var userLang = window.navigator.language,
  loadText = document.getElementById('load_text');

window.divoltePageSignal = {rootObjName: (window.rootObjName || ''), mac: (window.user_mac || '')};
window.suppress_error_message = true;

if( ~userLang.indexOf('ru') ){
  loadText.innerHTML = 'подождите, <br/>идет загрузка'
}

if( ~userLang.indexOf('en') ){
  loadText.innerHTML = 'loading...<br/>please, wait'
}

function refresh(event) {
    if (event && event.preventDefault) {
        event.preventDefault();
    }
    document.getElementById('loader_holder').style.display = '';
    document.getElementById('error').style.display = 'none';
    checkAuth('', '88-70-8c-93-b8-df', '/auth/check', '/success?client_mac=88-70-8c-93-b8-df');
}

initAuth('', '88-70-8c-93-b8-df', '/auth/init', '/auth/check', '/success?client_mac=88-70-8c-93-b8-df');</script>
  <script>var body = document.getElementById('cp');
var loader = document.getElementById('ld');
body.style.opacity = '0';
body.style.pointerEvents = 'none';
document.addEventListener(""DOMContentLoaded"", function onLoad() {
  var userLang = window.navigator.language,
    loadTextHead = document.getElementById('hd'),
    loadTextMain = document.getElementById('mn'),
    loadTextFooter = document.getElementById('ft');

  if( ~userLang.indexOf('ru') ){
    loadTextHead.innerHTML = 'Приветствуем вас<br> в Wi-Fi сети MT_FREE';
    loadTextMain.innerHTML = '<a class=""captive-wrapper__main-link"" href=""//gowifi.ru"">Войти в интернет</a>';
    loadTextFooter.innerHTML = 'Для продолжения подключения<br> перейдите по ссылке &mdash; <a class=""captive-wrapper__footer-link"" href=""//gowifi.ru"">gowifi.ru</a>';
  }

  if( ~userLang.indexOf('en') ){
    loadTextHead.innerHTML = 'Welcome to the MT_FREE<br> Wi-Fi Network';
    loadTextMain.innerHTML = '<a class=""captive-wrapper__main-link"" href=""//gowifi.ru"">Connect</a>';
    loadTextFooter.innerHTML = 'To continue connecting, please,<br> follow the link <a class=""captive-wrapper__footer-link"" href=""//gowifi.ru"">gowifi.ru</a>'
  }

  setTimeout(function () {
    if (~window.navigator.userAgent.indexOf('OS 12_')) {
      loader.style.display = 'none';
      body.style.opacity = '1';
      body.style.pointerEvents = 'auto';
    }
  }, 5000);
  if (typeof divolte !== 'undefined') {divolte.signal('pageView', window.divoltePageSignal)}
});</script>
 </body>
</html>
[+0001] Initializing auth procedure
[+0038] {""result"":true,""user_mac"":""88-70-8c-93-b8-df"",""auth_status"":""initial"",""auth_error_code"":null}
[+0000] Checking auth status
[+0022] {""result"":true,""auth_status"":""success"",""auth_error_code"":null}
[+0000] Finishing auth procedure
[+0107] <HTML><HEAD><TITLE> Web Authentication Redirect</TITLE><META http-equiv=""Cache-control"" content=""no-cache""><META http-equiv=""Pragma"" content=""no-cache""><META http-equiv=""Expires"" content=""-1""><META http-equiv=""refresh"" content=""1; URL=http://auth.wi-fi.ru/?segment=metro""></HEAD></HTML>

[+0001] Checking Internet connection
[+0005] Switching to another algorithm: MosMetroV2WV (this is not an error)
[+0407] Checking Internet connection
[+0035] http://auth.wi-fi.ru/?segment=metro
[+0000] Opening auth page
[+0000] Waiting for auth page to load
[+0259] InterceptedClient (1114846576) | onPageStarted(http://auth.wi-fi.ru/?segment=metro)
[+0000] InterceptedClient (1114846576) | Current URL | http://auth.wi-fi.ru/?segment=metro
"
mosmetro-android/mosmetro-android,open,Алгоритм MosMetroV2WV,"[Label(name=""algorithm"")]","Данный тикет предназначен для отслеживания финальных правок, необходимых для слияния веток master и webview. В результате в master появится алгоритм MosMetroV2WV, заменяющий MosMetroV2 и, в данный момент, более устойчивый перед блокировками со стороны провайдера.

* [ ] Отключить MosMetroV2WV по умолчанию в ""Настройках подключения"" до завершения полномасштабного тестирования;
* [ ] Снова добавить возможность запускать WebView только раз в сутки, а в остальных случаях использовать MosMetroV2;
  * Если возможно, то лучше сделать cooldown настраиваемым (например, по одному разу утром и вечером);
* [ ] Перевести на русский язык сообщения, связанные с работой нового алгоритма;
* [ ] Решить, что делать с тестовыми настройками: перевести и оставить или удалить?
  * pref_trust_all_certs
  * Override URL blacklist RegExp
* [x] Реализовать таймаут ожидания работы скрипта на случай изменения структуры страницы;
  * В случае изменения вёрстки скрипт автоматизации может застрять на нетипичном моменте на неопределённый промежуток времени. В таком случае пользователю нужно сообщить о причине ""зависания"" и предложить отправить лог подключения;
  * За максимальное время работы скрипта можно принять 2 минуты. В идеальных условиях подключение происходит за 20 секунд. Также оно может быть замедлено обратным отсчётом на полноэкранной рекламе;
* [ ] Добавить возможность просмотра содержимого WebView в процессе подключения;
  * Желательно, чтобы WebView отображался только в окне с логом, а не поверх всех окон;
  * Это также позволит подключать ПК-версию Chrome для отладки в реальном времени;"
mosmetro-android/mosmetro-android,open,[8.0] Создание ярлыков из главного меню не работает,"[Label(name=""blocked""), Label(name=""regression"")]","Из-за [новой политики](https://developer.android.com/about/versions/oreo/android-8.0-changes#as) по отношению к ярлыкам, принятой в Android 8.0, создать ярлык теперь можно только либо через лаунчер, либо с помощью метода [ShortcutManager.requestPinShortcut()](https://developer.android.com/reference/android/content/pm/ShortcutManager#requestPinShortcut(android.content.pm.ShortcutInfo,%20android.content.IntentSender)), недоступного в SDK 25, под который сейчас собирается приложение.

* [x] Скрыть кнопку из главного меню на Android 8.0 (временное решение)
* [ ] Перейти на SDK 27 (#197)
* [ ] Реализовать создание ярлыков через ShortcutManager (постоянное решение)"
mosmetro-android/mosmetro-android,closed, master #359 - Ошибка: устройство не зарегистрировано в сети,"[Label(name=""needs info"")]","Android 5.1

Версия  master #359 выдает ошибку **Ошибка: устройство не зарегистрировано в сети**
Версия master-#350-70 подключается без проблем.

Логи
master-350: https://yadi.sk/i/MRiF5ANI3aN5un
master-359: https://yadi.sk/i/MC23BAYx3aN5yD"
mosmetro-android/mosmetro-android,closed,Поддержка welcome.wi-fi.ru (MosMetroV3),"[Label(name=""algorithm"")]","Довольно давно в сети метро, а затем и в других, появился домен welcome.wi-fi.ru, на который иногда выдаётся перенаправление. До этого момента приложение игнорировало такие случаи и пыталось подключиться напрямую через auth.wi-fi.ru. Однако в последнее время всё чаще возникают проблемы в Санкт-Петербурге, причиной чего может быть именно ""welcome"".

* [x] Создать класс MosMetroV3
* [x] Определить критерии выбора этого алгоритма: **Meta перенаправление на welcome.wi-fi.ru**
* Реализовать последовательность запросов
  * [x] GET welcome.wi-fi.ru/?client_mac=...
  * [x] POST welcome.wi-fi.ru/auth/init
  * [x] GET welcome.wi-fi.ru/auth/check?client_mac=...&client_ip=
  * [x] GET welcome.wi-fi.ru/success?client_mac=...
  * [x] Переход к другому алгоритму в случае необходимости
  * [x] Финальный тест (сборка №4)
* Другое:
  * [x] Экспортировать сообщения в strings.xml и перевести их на русский
  * [x] Определение необходимости регистрации устройства: **сводится к MosMetroV2**"
mosmetro-android/mosmetro-android,closed,Работа приложения на Android P,"[Label(name=""duplicate"")]","1. Не срабатывает создание уведомления о подключении
2. Не определяется наименование сети ( Подключение к сети <unknown since ssid> )

Девайс - Google Pixel
Версия Android - P (сборка PPP2. 180412.013)
Версия приложения - master-#349-70"
mosmetro-android/mosmetro-android,closed,Moscow Wi-Fi Plugin : App get crashes on clicking 'Developer' from 'More information' tab.,[],"**Expected Behavior**
The app should have shown the **Developer** information when clicking the **Developer** from *More information* section.

**Actual Behavior**
But the crashes in clicking **Developer** (*Dmitry Karikh*)

**How to reproduce**
1. First download the app from F-Droid.
2. Launch the app.
3. Ignore the dialogue box if it appears.
4. Then scroll down the app. You can find there **More information** section. Tab on that.
5. You can see **Developer** option at first when tabbing **More information**. Tab on that.
The app then crashes.

 • App Version : 1.8.3.2-70
 • Operating System : Android 6.0
 • Device : Lava Iris 50

**Recording of the bug**
https://www.youtube.com/watch?v=3_CbINZzm-A"
mosmetro-android/mosmetro-android,closed,Doens't work in the ground transport of spb.,[],"Works in subwaway but not in trams and buses of the Saint-Petersburg.

More logs should be provided."
mosmetro-android/mosmetro-android,open,not mosmetro,[],"You should rename the application as it's not for Moscow only.
It also works in Saint-Petersburg metro.
Please don't confuse users."
mosmetro-android/mosmetro-android,closed,Oreo icon shape,[],"Please add support for icon shape
https://developer.android.com/guide/practices/ui_guidelines/icon_design_adaptive.html
https://material.io/guidelines/style/icons.html"
mosmetro-android/mosmetro-android,closed,Help! Необходима помощь в подключении к wifi сети,[],"Я понимаю что я не по теме но прошу помочь. Мне необходимо создать простую "" подключалку для андроид"" к сети wifi (приложение APK)c заранее известным Ssid и Pasword ом. Я создал устройство и мне необходимо чтобы конечный пользователь включил его и запустил мое приложение которое автоматически подключило бы смартфон или планшет на os android к моей AP (точке доступа) wifi сети. то есть практически как mosmetro android... только гораздо проще. Несколько дней брожу по интернету но даже намека на такое приложение нет. Может кто подскажет где есть ресурс с исходниками.  или какой то сайт где эта тема затрагивалась.  В  программировании я еще слаб но редактировать не много могу."
mosmetro-android/mosmetro-android,open,принудительный connect из-под Tasker / Automate,[],"Хочу настроить скрипт для Tasker / Automate, который бы при BT-подключении айфона к Android-офону со стоящим на нём Метро-Автовходом принудительно запускал его на повторный коннект, подобно виджету ""Create shortcut > Connect in the background""

Есть ли для этого готовая возможность / можно ли ее добавить?"
mosmetro-android/mosmetro-android,closed,"Не ""Умирает"" фоновое подключение","[Label(name=""bug""), Label(name=""needs info"")]","При ""ручном"" режиме подключения, с ярлыком на подключение в фоновом режиме, приложение остаётся висеть в фоне после успешного подключения и мониторит сети. Самый верный способ отключить - нажать ""закрыть все"" в... Не знаю как это называется, там где открытые приложения переключаются.
Андроид 7.0, Xiaomi Mi Max, прошивка от miui.su"
mosmetro-android/mosmetro-android,closed,Некорректная обработка таймаута в WebViewService,[],"При установке параметра pref_timeout в 0 попытка загрузки WebView приводит к немедленному появлению ошибки Synchronizer timed out, хотя значение pref_timeout == 0 обозначает отсутствие таймаута"
mosmetro-android/mosmetro-android,closed,Adaptive icons,"[Label(name=""enhancement"")]",Слияние заблокировано тикетом #197. Для работы адаптивных иконок необходимо перейти на новую версию SDK (25 -> 27).
mosmetro-android/mosmetro-android,open,Обновление до SDK 27,"[Label(name=""regression"")]","После перехода основной ветки на Android API 27 возникло несколько довольно серьёзных проблем с ранее стабильными компонентами:

* [x] Поддержка адаптивных иконок;
  * [x] Иконки сломаны на Android 7.x (и, возможно, более старых версиях);

![default](https://user-images.githubusercontent.com/6968908/43988665-6a54df3c-9d43-11e8-9bf8-b10695ecfca4.png)

* [x] На Android 8 перестали работать уведомления (в частности новости). Чтобы их исправить, нужно применить этот [патч](https://github.com/mosmetro-android/mosmetro-android/commit/30f1d6e82634fd220f02ab054e2c9475c48f33dd) или что-то получше;
  * [x] ~~setPriority() больше не работает. Вместо этого используется importance для канала уведомлений. При этом importance сменить невозможно, что лишает нас возможности менять приоритет уведомлений на ходу. Это осложняет работу постоянного фонового процесса (см. ниже);~~
  * [ ] Забыть обо всём, что написано выше, и реализовать два канала уведомлений: для постоянного процесса и остальных. Тогда пользователь сможет сам указать приоритет уведомлений по своему желанию;
* [x] Перестало работать автоматическое подключение из-за отмены поддержки необходимых ресиверов, в данный момент прописанных в манифесте. Нужно создать постоянный сервис **с уведомлением** и регистрировать ресиверы динамически. [[источник](https://stackoverflow.com/a/45819605)];
  * [x] Реализовать постоянный фоновый процесс для ресиверов;
  * [x] Запускать процесс при открытии главного меню, переключении виджета и при загрузке системы (если автоподключение активно);
  * [x] Защитить процесс с помощью уведомления;
  * [x] Интегрировать уведомления ConnectionService и нового сервиса;
  * [x] ~~Создавать уведомление с низким приоритетом (см. выше);~~
    * ~~**Спрятать иконку foreground процесса невозможно** [[источник](https://issuetracker.google.com/issues/69842394#comment8)];~~
  * [ ] Сделать процесс отключаемым на Android 7.x и ниже (и **отключить по умолчанию**);
  * [ ] Уникальная иконка для уведомления процесса?
* [ ] Android закрыл доступ к названию сети. Нужно запросить получение к информации о местоположении устройства. [[источник](https://stackoverflow.com/q/49977395)];
  * При этом через Intent название доступно. Только лог немного пострадал.
  * [ ] Другой вариант: Получать название сети только из Intent на Android 8.0+. Это позволит избежать запроса дополнительных разрешений.
* [ ] Создание ярлыков из главного меню не работает (#211);
* [ ] Начиная с API 26 [TYPE_TOAST](https://developer.android.com/reference/android/view/WindowManager.LayoutParams.html#TYPE_TOAST) перестаёт работать. Это не позволит нам без дополнительных разрешений запускать WebView ""в фоне""."
mosmetro-android/mosmetro-android,closed,Update Adaptive icons,[],
mosmetro-android/mosmetro-android,closed,Перевести сборку на Jenkins Pipeline,"[Label(name=""enhancement"")]","Старые проекты на Jenkins после множества обновлений не очень хорошо себя чувствуют. Пора полностью зафиксировать сборочный процесс в этом репозитории.

* [x] Написать [Jenkinsfile](https://github.com/mosmetro-android/backend/blob/master/Jenkinsfile);
* [x] Добавить поддержку Pipeline API в https://github.com/mosmetro-android/backend;
* [x] Синхронизировать текущие номера сборок с новым проектом;
* [x] Окончательно мигрировать на новый проект;
* [x] Заархивировать сотни старых сборок.
"
mosmetro-android/mosmetro-android,closed,Added adaptive icon,[],
mosmetro-android/mosmetro-android,closed,Сброс регистрации устройства,[],"Каждый раз, при подключении, пишет ""устройство не зарегистрировано"" и просит заново пройти регистрацию.
Раз в сутки, или после перезагрузки устройства. Как выяснилось, привязывается мак адрес устройства, который при каждом включении устройства меняется по виду: `XX:XX:XX:aa:aa:aa` где ХХ постоянные цифры.
Прошивал на стоковые прошивки, кастомные, не лечиться. На девайсе где не было установлено приложение таких проблем нет."
mosmetro-android/mosmetro-android,closed,Tasker,[],"Хотелось бы видеть событие onBlocked, посылающееся при блокировке провайдером"
mosmetro-android/mosmetro-android,open,Приложение не реагирует на отключение Wi-Fi,"[Label(name=""bug"")]","Во время подключения отключаю Wi-Fi, но приложение всё равно пытается подключиться. На нажатия на кнопку ""Остановить"", ни в уведомлении в шторке, ни в окне с логом подключения приложение также не реагирует
Привязка к сети включена, если это важно.

* Highscreen Power Four
* Android 5.1 (почти)чистый
* Версия приложения 1.8.3.2-70"
mosmetro-android/mosmetro-android,open,Автоматическая регистрация/удаление устройства,"[Label(name=""discussion"")]","Позволит обойти бан провайдером удалением и повторной регистрацией устройства через cabinet.wi-fi.ru, который доступен, в том числе, при блокировке.
Примерная последовательность:
1. обнаружение блокировки/ошибки 1310
2. авторизация в cabinet.wi-fi.ru
3. удаление устройства
Проверка статуса регистрации. Проверка наличия данных для автоматической регистрации.
4. регистрация через телефон (нужен номер) или через Госуслуги (номер/пароль/куки или перекинуть в браузер)
5. обычный обход рекламы"
mosmetro-android/mosmetro-android,closed,Подробный статус в оповещениях,[],Вместо непонятного `1/3` показывать стадии как в дебаг активити
mosmetro-android/mosmetro-android,closed,Текст в уведомлениях иногда пропадает,"[Label(name=""bug"")]","Похоже, что это побочный эффект коммита https://github.com/mosmetro-android/mosmetro-android/commit/d147b54aadb5c70b258b7a1154c53f7b5ffb11f2. Нужно будет более внимательно протестировать.

![screenshot-17 12 06-17 37 55](https://user-images.githubusercontent.com/6968908/33666859-49108560-daac-11e7-95d6-31f76309321a.png)
"
mosmetro-android/mosmetro-android,closed,Ограничить размер лога,"[Label(name=""crash"")]","Иногда лог разрастается до такой степени, что DebugActivity падает. Раньше та же проблема была с отправкой лога, но она более-менее решилась записью лога в файл. Надо либо удалять старые записи, либо показывать в DebugActivity только часть лога.

```
java.lang.RuntimeException: android.os.TransactionTooLargeException: data parcel size 537404 bytes
 at android.app.ActivityThread$StopInfo.run(ActivityThread.java:3840)
 at android.os.Handler.handleCallback(Handler.java:754)
 at android.os.Handler.dispatchMessage(Handler.java:95)
 at android.os.Looper.loop(Looper.java:163)
 at android.app.ActivityThread.main(ActivityThread.java:6321)
 at java.lang.reflect.Method.invoke(Native Method)
 at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:880)
 at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:770)
Caused by: android.os.TransactionTooLargeException: data parcel size 537404 bytes
 at android.os.BinderProxy.transactNative(Native Method)
 at android.os.BinderProxy.transact(Binder.java:618)
 at android.app.ActivityManagerProxy.activityStopped(ActivityManagerNative.java:3669)
 at android.app.ActivityThread$StopInfo.run(ActivityThread.java:3832)
 ... 7 more
```"
mosmetro-android/mosmetro-android,open,Исключить двойную проверку интернета в начале подключения,"[Label(name=""algorithm""), Label(name=""enhancement"")]","В начале каждого подключения функция Provider.find() отпраляет один запрос, чтобы по ответу сервера определить провайдера и создать его объект. Затем Provider отправляет тот же самый запрос, чтобы получить необходимую для своей работы информацию (например, redirect в MosMetroV2).

Нужно исключить подобные повторы, как это уже сделано в классе Unknown (dd62e7bdf5a3298fc21665203cfac34e589b8396). Однако важно учесть, что один и тот же объект Provider может запускаться несколько раз (он запускается в [цикле](https://github.com/mosmetro-android/mosmetro-android/blob/a12805603da0cdb484793187b3e57dd0217e228c/app/src/main/java/pw/thedrhax/mosmetro/services/ConnectionService.java#L227-L227)). Для Unknown это не критично, но в MosMetroV2, например, на первом шаге может быть результат ALREADY_CONNECTED, который в случае использования того же запроса никогда не будет достигнут.

Нужно либо всегда создавать новый объект Provider, либо исключать проверку интернета только при первом запуске алгоритма. Первое решение навсегда перенесёт ALREADY_CONNECTED в класс Unknown, что было бы очень неплохо. В общем, надо подумать над этим."
mosmetro-android/mosmetro-android,open,"Добавить поддержку сети ""Moscow_Wi-Fi_Free""",[],
mosmetro-android/mosmetro-android,closed,Текст в уведомлениях,[],"Сейчас все уведомления не разворачиваемые, и текст который не влез в ширину шторки не прочитать "
mosmetro-android/mosmetro-android,open,Нерабочий бинд к сети wi-fi при активном vpn,[],"С активным впн, вайфаем и мобильной сетью приложение не может забиндиться на вайфай даже если впн приложение не перенаправляет трафик. 

Android 7.1"
mosmetro-android/mosmetro-android,closed,Исключить ручное самостоятельное подключение к сети в метро,[],"Приходится постоянно самостоятельно подключаться к сети в метро
Т.е. 
+ в уведомлениях появляются доступная сеть Mхх_Free - точное название не помню :)
+ или там написано ""Требуется выполнить вход в сеть Mхх_Free""

Нажимаю на уведомление, открываются окно подключения к WiFi-сетям (просмотра всех доступных сетей).
Выбираю нужную сеть, нажимаю ""Подключиться"", и только после этого продукт начинает отрабатывать.

В документации не увидел описания подобной фичи.

Хотелось бы, чтобы при наличии обрабатываемых продуктов WiFi-сетей и наличии настройки автоподключения в настройках продукта выполнялось автоподключение нужной WiFi -сети."
mosmetro-android/mosmetro-android,closed,ConnectionService иногда внезапно завершается,"[Label(name=""bug"")]","Событие DISCONNECTED инициирует завершение фонового процесса, но уже через ~200 мс  
Wi-Fi снова подключается. Похоже, процесс завершается слишком долго, поэтому сигнал игнорируется.

* Можно попробовать придерживать новое событие запуска, если `!running && lock`, т.е. пока завершение ещё в процессе. Но в таком случае процесс может запуститься уже после отключения от сети.

* Установить running обратно в true и надеяться на лучшее. Это должно прервать завершение процесса, но все варианты проверить будет сложно. В крайнем случае выполнение дойдёт до рекурсивного вызова функции main() (кстати, надо бы от рекурсии избавиться).

```
[+0326] NetworkReceiver (86697492) | Intent: android.net.wifi.STATE_CHANGE (DISCONNECTED)
[+0001] ConnectionService (200295310) | Stopping by Intent
[+0094] NetworkReceiver (215367357) | Intent: android.net.wifi.STATE_CHANGE (ASSOCIATING)
[+0116] NetworkReceiver (25459890) | Intent: android.net.wifi.STATE_CHANGE (ASSOCIATED)
[+0001] ConnectionService (200295310) | Started by system
[+0023] NetworkReceiver (118719491) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0005] ConnectionService (200295310) | Started by system
[+0015] NetworkReceiver (47861632) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0001] ConnectionService (200295310) | Started by system
[+0161] NetworkReceiver (137169337) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0002] ConnectionService (200295310) | Started by system
[+0034] NetworkReceiver (37335550) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0004] ConnectionService (200295310) | Started by system
[+0030] NetworkReceiver (255876447) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0003] ConnectionService (200295310) | Started by system
```"
mosmetro-android/mosmetro-android,closed,Сообщать системе о наличии соединения с интернетом,"[Label(name=""enhancement"")]","Насколько я помню, в Android есть метод API, который позволяет приложениям ""голосовать"" за наличие или отсутствие интернета. Если после подключения сообщить системе о том, что соединение появилось, есть некоторый шанс, что уведомление ""Подключиться к Wi-Fi"" может пропасть, и тогда трафик пойдёт через WI-Fi, а не мобильную сеть."
mosmetro-android/mosmetro-android,closed,[httpclient] MosMetroV2: Провайдер не опознан,"[Label(name=""bug"")]","Скорее всего сломался парсер meta-перенаправлений, однако юнит-тесты этого не показали.

```
[+0008] Определение провайдера…
[+0360] URL:  http://google.ru/generate_204
Response code: 200
location: http://auth.wi-fi.ru/?segment=metro
content-length: 288
content-type: text/html
<html>
 <head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://auth.wi-fi.ru/?segment=metro"">
 </head>
 <body> 
 </body>
</html>
[+0001] Ошибка: провайдер не опознан
```

* [x] Проверить ветку issue-135 (основана на httpclient)
* [x] Проверить ветку httpclient"
mosmetro-android/mosmetro-android,closed,[httpclient] Наличие блокировки не распознаётся,"[Label(name=""bug"")]","В новом HTTP-клиенте не работает обнаружение блокировки провайдера. Вместо этого скрипт выдаёт ошибку из-за отсутствия CSRF-токена на странице.

*Лог не сохранился, давно это было. Данный тикет нужен, чтобы не забыть про проблему.*"
mosmetro-android/mosmetro-android,closed,Не может обойти блокировку,[],"Не может обойти блокировку, которая спокойно обходится через http://auth.wi-fi.ru/auth?segment=aeroexpress
![screenshot_20171025-195702](https://user-images.githubusercontent.com/8061587/32012037-53562452-b9bf-11e7-9b4f-8b201cd6073b.png)
"
mosmetro-android/mosmetro-android,closed,Возможное тестирование алгоритма MosMetroV3,"[Label(name=""algorithm"")]","Уже в течение долгого времени периодически получаю отчёты и сообщения о перенаправлении на welcome.wi-fi.ru, в результате которого старый алгоритм MosMetroV2 работать отказывается. Пора собрать о нём всю информацию, а то оно появляется всё чаще.

* [x] Собрать лог подключения
* [ ] Дамп подключения ([Packet Capture](https://github.com/mosmetro-android/mosmetro-android/wiki/Создание-дампа-подключения) или лучше mitmproxy)
* [ ] Определить отличия от текущего алгоритма
* [ ] Реализовать класс MosMetroV3 или доработать MosMetroV2

# Лог подключения (урезанный)

```
[+0007] Проверка доступа в интернет
[+1104] <html>
 <head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://welcome.wi-fi.ru/?client_mac=hi-dd-en"">
 </head>
 <body> 
 </body>
</html>
```

```
[+0028] Получение перенаправления
[+3131] CookieJar | Add: _auth_session = HIDDEN
[+0026] <!doctype html>
<html class=""no-js"">
 <head>
  <meta charset=""utf-8"">
  <meta content=""text/html; charset=UTF-8"" http-equiv=""Content-Type"">
  <meta content=""no-cache,no-store,must-revalidate"" http-equiv=""Cache-Control"">
  <meta content=""no-cache"" http-equiv=""Pragma"">
  <meta content=""-1"" http-equiv=""Expires"">
  <meta content=""noindex, nofollow"" name=""robots"">
  <meta content=""always"" name=""referrer"">
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link href=""/favicon.ico"" rel=""icon"" type=""image/x-icon"">
  <link href=""/favicon.ico"" rel=""shortcut icon"" type=""image/x-icon"">
  <title>Авторизация Wi-Fi</title>
  <meta content=""АО «МаксимаТелеком»"" name=""author"">
  <meta name=""csrf-param"" content=""authenticity_token""> 
  <meta name=""csrf-token"" content=""HIDDEN"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/application-5d02f46eb70fbdc4acacba3e5b9de1df4e7607ec37ebdd51b08248c7ba779394.css"">
 </head>
 <body class=""img-line"">
  <div class=""map-mosmetro"" id=""root"">
   <div id=""content"">
    <div class=""header"">
     <h1 class=""header-title"">Добро пожаловать <br>на Wi‑Fi.ru</h1>
     <p class=""header-text"">С услугой «Как дома» Wi-Fi подключается автоматически, как только вы входите в вагон.</p>
    </div>
    <div id=""loader""></div>
    <div id=""error"">
     <p class=""error-text"" id=""error-text""></p>
     <a class=""btn-login divolte_signal"" data-objname=""error_retry"" data-objeventtype=""retry"" href=""/?client_mac=hi-dd-en"">Повторить</a>
    </div>
   </div>
  </div>
 </body>
</html>
```"
mosmetro-android/mosmetro-android,closed,Генерация более правдоподобных User-Agent'ов,"[Label(name=""enhancement"")]","Думаю, стоит вернуть предыдущий подход с подстановкой информации об устройстве в скобки. Только заменить статичный User-Agent на большой набор мобильных браузеров.

А то сейчас одно и то же устройство может отправлять запросы от имени какого-нибудь Chrome с Windows XP и сразу же менять его на Firefox с Mac OS.

* [x] Добавить возможность ручного ввода User-Agent
* [x] Собрать список мобильных User-Agent'ов
* [x] Заменить класс RandomUserAgent на собственную реализацию
* [x] Закрепить сгенерированный User-Agent в настройках и использовать его в будущем"
mosmetro-android/mosmetro-android,closed,Вынос кода авторизации в отдельную библиотеку,[],"Вынос кода авторизации в отдельную библиотеку, чтобы её можно было использовать в других программах. 

Например, очень не хватает автоматической авторизации для ноутбуков (linux, windows, mac os).

Если бы была бы библиотека, не привязанная к Android, то можно было бы написать простенький скрипт, её задействующий.

P.S. Собственно, чтобы автоматически работал проект типа [mosmetro-python](https://github.com/TheDrHax/mosmetro-python)."
mosmetro-android/mosmetro-android,closed,Изменённые иконки в статусбаре плохо видны,[],"Белые иконки смотрелись лучше, особенно на контрастных фонах вроде красного / синего

![photo_2017-10-02_15-08-42](https://user-images.githubusercontent.com/823143/31076611-b9128068-a783-11e7-871a-e0210fa93ec0.jpg)
![photo_2017-10-02_15-08-54](https://user-images.githubusercontent.com/823143/31076615-c13cc9e2-a783-11e7-99d5-d31442387e32.jpg)
"
mosmetro-android/mosmetro-android,closed,NewsChecker: RuntimeException,"[Label(name=""crash""), Label(name=""report/google play"")]","```
java.lang.RuntimeException: 
  at android.os.AsyncTask$3.done (AsyncTask.java:300)
  at java.util.concurrent.FutureTask.finishCompletion (FutureTask.java:355)
  at java.util.concurrent.FutureTask.setException (FutureTask.java:222)
  at java.util.concurrent.FutureTask.run (FutureTask.java:242)
  at java.util.concurrent.ThreadPoolExecutor.runWorker (ThreadPoolExecutor.java:1112)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run (ThreadPoolExecutor.java:587)
  at java.lang.Thread.run (Thread.java:841)
Caused by: java.lang.NullPointerException: 
  at pw.thedrhax.mosmetro.updater.NewsChecker.doInBackground (NewsChecker.java:69)
  at pw.thedrhax.mosmetro.updater.NewsChecker.doInBackground (NewsChecker.java:41)
  at android.os.AsyncTask$2.call (AsyncTask.java:288)
  at java.util.concurrent.FutureTask.run (FutureTask.java:237)
```"
mosmetro-android/mosmetro-android,closed,StatisticsTask: NullPointerException,"[Label(name=""crash""), Label(name=""report/google play"")]","```
java.lang.NullPointerException: 
  at pw.thedrhax.mosmetro.authenticator.StatisticsTask$2.result (StatisticsTask.java:109)
  at pw.thedrhax.mosmetro.updater.UpdateCheckTask.onPostExecute (UpdateCheckTask.java:129)
  at pw.thedrhax.mosmetro.updater.UpdateCheckTask.onPostExecute (UpdateCheckTask.java:42)
  at android.os.AsyncTask.finish (AsyncTask.java:692)
  at android.os.AsyncTask.-wrap1 (AsyncTask.java)
  at android.os.AsyncTask$InternalHandler.handleMessage (AsyncTask.java:709)
  at android.os.Handler.dispatchMessage (Handler.java:105)
  at android.os.Looper.loop (Looper.java:156)
  at android.app.ActivityThread.main (ActivityThread.java:6577)
  at java.lang.reflect.Method.invoke (Native Method)
  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run (ZygoteInit.java:942)
  at com.android.internal.os.ZygoteInit.main (ZygoteInit.java:832)
```"
mosmetro-android/mosmetro-android,closed,Client: NullPointerException,"[Label(name=""crash""), Label(name=""report/google play"")]","```
java.lang.NullPointerException: 
  at pw.thedrhax.mosmetro.httpclient.Client.parseMetaContent (Client.java:149)
  at pw.thedrhax.mosmetro.httpclient.Client.parseMetaRedirect (Client.java:164)
  at pw.thedrhax.mosmetro.authenticator.providers.MosMetroV2.isConnected (MosMetroV2.java:437)
  at pw.thedrhax.mosmetro.services.ConnectionService.main (ConnectionService.java:368)
  at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent (ConnectionService.java:283)
  at android.app.IntentService$ServiceHandler.handleMessage (IntentService.java:66)
  at android.os.Handler.dispatchMessage (Handler.java:102)
  at android.os.Looper.loop (Looper.java:148)
  at android.os.HandlerThread.run (HandlerThread.java:61)
```"
mosmetro-android/mosmetro-android,closed,update readme.md,[],"добавил пункт лицензии
а также отказ от ответственности за последствия"
mosmetro-android/mosmetro-android,closed,Новая блокировка автоподключения,[],"При подключении каким-то образом обнаруживает приложение и запрещает вход. 
- [ ] Выяснить каким образом обнаруживает приложение 
- [ ] Придумать методы противодействия"
mosmetro-android/mosmetro-android,open,[spb-domru] Поддержка провайдера Дом.ру,"[Label(name=""algorithm""), Label(name=""needs info"")]","# Описание сети

| Параметр | Значение |
| :--- | --- |
| Местоположение | Санкт-Петербург и другие города (подробнее?) |
| SSID | DOM.RU Wi-Fi |
| Аутентификация | MAC (?), номер телефона, Cookies |
| Название алгоритма | [DomRu](https://github.com/mosmetro-android/mosmetro-android/blob/spb-domru/app/src/main/java/pw/thedrhax/mosmetro/authenticator/providers/DomRu.java) |

# План действий

* Дамп авторизации
  * [x] Простое подключение
  * [x] Подключение с чистой сессией (приватный режим или просроченные Cookies)
  * [ ] Чистый дамп из приватного режима браузера
  * [ ] Что делает https://spb.wifi.domru.ru/assets/5c2e7edf/guest.js?
  * [ ] Код страницы https://spb.wifi.domru.ru/guest с незарегистрированного устройства
* Реализация алгоритма
  * [x] Определение провайдера
  * [ ] Алгоритм подключения
      * [x] ~~Без номера телефона~~
      * [x] ~~С вводом номера телефона в настройках~~ (чего-то не хватает)
      * [ ] Полное повторение последовательности подключения (см. дамп №3)
* Подробности о регистрации в сети
  * [x] Где и как регистрироваться: Аналогично МаксимаТелеком, зайти через браузер 1 раз с подтверждением по СМС
  * [ ] Как узнать, что устройство не зарегистрировано? (см дамп №5)
* Доработки интерфейса
  * [ ] Добавить текст для поля с номером телефона в настройках
  * [ ] Попросить пользователя ввести номер телефона при первом подключении
  * [ ] Добавить перенаправление на регистрацию (см. выше)

> *Чтобы ничего не забыть :)*"
mosmetro-android/mosmetro-android,closed,Модуль распознавания капчи не отвечает,[],"На некоторых устройствах модуль распознавания капчи не отвечает на запросы от приложения. Неизвестно, не успевает он или вообще не запускается.

Нужно найти какой-то другой способ взаимодействия между приложениями или разобраться с https://github.com/mosmetro-android/module-captcha-recognition/issues/4 и встроить модуль в основное приложение."
mosmetro-android/mosmetro-android,open,Подключается через мобильную сеть даже с выключенным Wi-Fi,[],
mosmetro-android/mosmetro-android,closed,Нумерация версий,[],"Думаю, лучше начать нумеровать версии более очевидным образом. Сейчас у версии 1.7.7 целых три релиза. И лишь по номеру тега в репозитории (коду версии) можно понять какая из них последняя.

Возможно, следует делать бета-версии (1.7.7b1, 1.7.7b2) и/или релиз-кандидаты (1.7.7rc1, 1.7.7rc2). А теги могут соответствовать номеру версии. Если это, конечно, ничего не сломает."
mosmetro-android/mosmetro-android,open,Сеть иногда определяет наличие автоматизаторов,"[Label(name=""enhancement"")]","Критерии проверок неизвестны, поэтому нам остаётся только строить и проверять предположения.

## Текущие версии

* Тайминги подключения: приложение слишком быстро подключается по сравнению с обычными пользователями
  * [x] ~~Добавить задержку в 2 секунды между этапами подключения~~
  * [x] Добавить задержку в 5 секунд перед первым запросом (**163-delay**)
* User-Agent всегда один и содержит неактуальную версию Chrome
  * [x] Рандомная генерация User-Agent ([пример](https://github.com/mkstayalive/random-user-agent-java)) (**163-user-agent**)
* Другие заголовки HTTP
  * [ ] Accept никогда не меняется
* [x] Загрузка статических файлов может отслеживаться (**[httpclient](https://github.com/mosmetro-android/mosmetro-android/projects/4)**)"
mosmetro-android/mosmetro-android,closed,DownloadManager работает не на всех устройствах,"[Label(name=""enhancement""), Label(name=""external bug"")]","Как выяснилось, некоторые производители (например, Asus) меняют DownloadManager, из-за чего он работает не так, как ожидается. К тому же на Android 4.x с ним постоянно возникают проблемы из-за отсутствия поддержки TLSv1.2 и невозможности её включить.

* [x] Временно добавить в диалог альтернативную кнопку для скачивания сборок через браузер
* [x] **Отметить все изменения**: на некоторых устройствах приложение просто падает при попытке воспользоваться DownloadManager'ом
* [x] Реализовать #161
* [x] Создать ~~собственный~~ DownloadManager на базе OkHttp (**updater-test**)
* [ ] ~~Открытие APK на всех версиях API~~ **НЕНАВИСТЬ**"
mosmetro-android/mosmetro-android,closed,Избавиться от разрешения WRITE_EXTERNAL_STORAGE,"[Label(name=""enhancement"")]","Android ещё с первых версий поддерживает механизм ContentProvider, который позволяет предоставить доступ к файлам из Internal Storage для других приложений. Это можно использовать для отправки лога и других целей."
mosmetro-android/mosmetro-android,closed,Кнопки на уведомлениях не работают на Android < 5,"[Label(name=""bug"")]","Не совсем понятно, зачем нужна эта функция в библиотеке appcompat, если Instant Reply и кнопки на уведомлениях всё-равно ничего не делают. Нужно добавить проверку Android < 5 и не показывать кнопку на этих версиях."
mosmetro-android/mosmetro-android,closed,Изменение кнопок Google Play и F-Droid,[],Предложение по переносу кнопок Google Play и F-Droid из заголовка в описание (для их лучшей видимости).
mosmetro-android/mosmetro-android,closed,Обновление .play/description.txt,[],"Имею некоторый опыт написания текстов и в связи с просьбой в чатике обновить .play/description.txt, приступил к этому, но чутка разошелся и расписал весь файл.

Первый коммит не меняет смысл написанного, только способ донесения: сократил канцеляризмы, личные местоимения, сложные формулировки, чутка поменял форматирование.
Во втором коммите более сурово раскидал всё: убрал ненужные для рядового пользователя уточнения, расставил блоки по их важности, переписал повторы и еще по мелочи.

Каждое исправление могу обосновать, если надо.
Но финальная версия за тобой, конечно же.

Для обновления текста частично использовал сервис https://glvrd.ru."
mosmetro-android/mosmetro-android,closed,Метрошная вафля научилась определять приложение,[],"```
ошибку
[+0001] ConnectionService (94056680) | Stopping by result (ERROR)
[+0001] ConnectionService (94056680) | Broadcast | ConnectionService (RUNNING = false)
[+1823] ConnectionService (113091580) | Started from DebugActivity
[+0001] ConnectionService (113091580) | Broadcast | ConnectionService (RUNNING = true)
[+0004] 7 сент. 2017 г. 10:06:36 AM
[+0000] Версия приложения: 1.7.7-61
[+0001] Подключение к сети MT_FREE
[+0000] Определение провайдера…
[+0021] Название алгоритма: MosMetroV2
[+0000] Проверка доступа в интернет
[+0012] <html>
 <head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://auth.wi-fi.ru/?segment=metro"">
 </head>
 <body> 
 </body>
</html>
[+0000] http://auth.wi-fi.ru/?segment=metro
[+0000] Получение перенаправления
[+0032] CookieJar | Add: aid = 458a188fb849054cb33fc6645a7dce9797c09b7b2f259be1d64af8c95129c734
[+0000] CookieJar | Add: cookies_enabled = true
[+0004] <html>
 <head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-22fb87162eaa2a84819ff5f3c7f73ed6b03254246cb5a3339bd53df2f97eeed1.css"">
 </head>
 <body>
  <img class=""data_pixels"" src=""http://ads.adfox.ru/220463/getDefaultImage?p1=buxxf&amp;amp;p2=v"" alt=""Getdefaultimage?p1=buxxf&amp;amp;p2=v"">
  <img class=""data_pixels"" src=""http://ads.adfox.ru/220463/getCode?p1=buhvd&amp;amp;p2=v&amp;amp;pe=b&amp;amp;pfc=bezbz&amp;amp;pfb=dksmt&amp;amp;pr=eslgyih"" alt=""Getcode?p1=buhvd&amp;amp;p2=v&amp;amp;pe=b&amp;amp;pfc=bezbz&amp;amp;pfb=dksmt&amp;amp;pr=eslgyih"">
  <img class=""data_pixels"" src=""http://top-fwz1.mail.ru/counter?id=701848;js=na"" alt=""Counter?id=701848;js=na"">
  <img class=""data_pixels"" src=""http://banners.adfox.ru/transparent.gif"" alt=""Transparent"">
  <img class=""data_pixels"" src=""http://ads.adfox.ru/220463/getCode?p1=bxvpa&amp;p2=v&amp;p3=a"" alt=""Getcode?p1=bxvpa&amp;p2=v&amp;p3=a"">
  <div class=""no-js-page"" id=""loader-wrapper"">
   <div id=""loader"">
    <div class=""spinner""></div>
   </div>
  </div>
  <div class=""no-js-view"">
   <div class=""error-view"" style=""display: block;"">
    <h1 class=""message"">In order to continue, enable JavaScript execution in current browser</h1>
   </div>
  </div>
 </body>
</html>
[+0000] Получение страницы авторизации
[+0036] CookieJar | Add: aid = 458a188fb849054cb33fc6645a7dce9797c09b7b2f259be1d64af8c95129c734
[+0036] CookieJar | Add: aid = 458a188fb849054cb33fc6645a7dce9797c09b7b2f259be1d64af8c95129c734
[+0006] <html>
 <head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/pages/application-f64d871acb09f936048bd6e53d6478f6da6a76afb63b3a945b350dbe3c106351.css"">
 </head>
 <body>
  <div class=""main"">
   <div class=""content"">
    <div class=""message"">
     <div class=""info_sign""></div>
     <div class=""first"">
      Network access is blocked
     </div>
     <div class=""second"">
      Network access is blocked because your device contains software that may authorize automatically which contradicts 
      <a href=""//static.wi-fi.ru/docs/offers/offer_auth.pdf"">“The Terms and Conditions of Services“</a>
     </div>
     <div class=""third"">
      You can access the network in the normal mode in 24 hours if such program is deleted or browser configuration is changed.
     </div>
    </div>
   </div>
  </div>
  <div class=""footer"">
   <div class=""content"">
    <div class=""logo-kak-doma""></div>
    <div class=""text"">
     You can join 
     <a href=""https://pay.wi-fi.ru"">“At Home”</a> service to
     <br> automatically connect and access
     <br> Internet without having to watch ads.
    </div>
   </div>
  </div>
 </body>
</html>
[+0000] Отправка формы авторизации
[+0001] java.lang.Exception: Meta tag not found
	at pw.thedrhax.mosmetro.httpclient.Client.parseMetaContent(Client.java:158)
	at pw.thedrhax.mosmetro.authenticator.providers.MosMetroV2$6.run(MosMetroV2.java:248)
	at pw.thedrhax.mosmetro.authenticator.Provider.start(Provider.java:225)
	at pw.thedrhax.mosmetro.services.ConnectionService.connect(ConnectionService.java:232)
	at pw.thedrhax.mosmetro.services.ConnectionService.main(ConnectionService.java:342)
	at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent(ConnectionService.java:289)
	at android.app.IntentService$ServiceHandler.handleMessage(IntentService.java:66)
	at android.os.Handler.dispatchMessage(Handler.java:102)
	at android.os.Looper.loop(Looper.java:148)
	at android.os.HandlerThread.run(HandlerThread.java:61)

[+0000] Ошибка: сервер не ответил или вернул ошибку
[+0000] ConnectionService (113091580) | Stopping by result (ERROR)
[+0001] ConnectionService (113091580) | Broadcast | ConnectionService (RUNNING = false)
[+3615] NetworkReceiver (222233576) | Intent: android.net.wifi.STATE_CHANGE (COMPLETED)
[+0012] ConnectionService (64897190) | Started by system
[+0007] NetworkReceiver (62409447) | Wi-Fi not enabled
[+0002] ConnectionService (64897190) | Stopping by Intent
[+0011] NetworkReceiver (32798356) | Wi-Fi not enabled
[+0033] ConnectionService (64897190) | Stopping by Intent
[+0034] NetworkReceiver (196068669) | Wi-Fi not enabled
[+0005] ConnectionService (64897190) | Stopping by Intent
```"
mosmetro-android/mosmetro-android,closed,Блокировка доступа в интернет из-за приложения,"[Label(name=""algorithm"")]",Сеть начала определять программу и блокировать доступ к интернету.
mosmetro-android/mosmetro-android,closed,[Netbynet] generate_204 эмулируется сетью,"[Label(name=""algorithm"")]","Не уверен, везде ли так, но в моём случае Netbynet подменил запрос к google.com/generate_204 и тому URL из класса Provider. В результате приложение считает, что доступ в интернет есть, но в этот же момент происходит MITM-атака на другие запросы.

![photo_2017-09-06_11-13-43](https://user-images.githubusercontent.com/6968908/30101332-90e396b6-92f4-11e7-90c7-68d272af6d61.jpg)"
mosmetro-android/mosmetro-android,closed,CaptchaRequest: context instanceof Activity всегда false,"[Label(name=""bug"")]","После отделения DebugActivity от работы с классами Provider [эта](https://github.com/mosmetro-android/mosmetro-android/blob/master/app/src/main/java/pw/thedrhax/mosmetro/authenticator/captcha/CaptchaRequest.java#L69) проверка в CaptchaRequest стала всегда возвращать false. Это привело к тому, что в ручном подключении диалог ввода капчи не открывается автоматически, если включено уведомление о капче. Также это мешает реализовать сворачивание диалога в уведомление из #148.

Нужно как-то доставить сведения о том, откуда запущен процесс, до класса CaptchaRequest, однако он скрыт за множеством слоёв абстракций: ConnectionService -> Provider -> MosMetroV2 -> Task -> CaptchaRequest..."
mosmetro-android/mosmetro-android,closed,Сaptcha: convert cyrillic symbols,[],"Первый раз пишу код на Java, вот что накатал за 15 минут изучения языка :)

Пул-реквест относится к этому [обсуждению](https://github.com/TheDrHax/mosmetro-android/issues/148#issuecomment-319510012), где было предложено использовать русскую клавиатуру для ввода капчи без переключения языка. 

Мини-проверка:
http://ideone.com/MgIE4Y

Через полчаса буду в метро, заодно проверю."
mosmetro-android/mosmetro-android,closed,Added color scheme,[],"Добавил цветовую схему для устройств, начиная с 14 версии апи. "
mosmetro-android/mosmetro-android,closed,"Add ""Get it on F-Droid"" button",[],
mosmetro-android/mosmetro-android,closed,sompor78@gmail.com,[],go
mosmetro-android/mosmetro-android,closed,Привязка к Wi-Fi работает только из ручного подключения,"[Label(name=""bug"")]","Возможно, это ограничение для фоновых сервисов. Нужно попробовать решить эту проблему силами OkHttp и SocketFactory вместо API Android."
mosmetro-android/mosmetro-android,closed,Улучшение диалога ввода капчи,"[Label(name=""enhancement"")]","Довольно много идей сегодня прислали так что лучше их в виде списка оформить.

* [x] Увеличить размер изображения (#146)
* [x] Диалог закрывается при нажатии за его пределами (#145)
* [x] Автоматически устанавливать фокус на поле ввода
    * [x] Скрывать клавиатуру при закрытии диалога
* [x] ~~Переключать раскладку клавиатуры на латиницу~~ **невозможно**
    * Сделать свою клавиатуру? Сложно...
    * [x] [Возможность набирать кириллицей](https://github.com/TheDrHax/mosmetro-android/issues/148#issuecomment-308651125)
* [x] ~~Добавить кнопку ""Не беспокоить 10 мин.""~~ Вынести настройку отключения диалога в сам диалог
* [x] Возможность ввода капчи прямо через уведомление (Android 7.0+)
* [x] Предоставить информацию, из какого приложения вообще этот диалог появился
* [x] Диалог сбрасывается при повороте экрана
* [x] Диалог сбрасывается при переключении между приложениями: Сворачивать диалог в уведомление?
    * Убрать `excludeFromRecents`
    * Определить, запущен диалог из фона или из DebugActivity (требуется #154)
    * Не запускать `finish()` из `onPause()` у диалога, запущенного из DebugActivity
    * Вызывать диалог из фона с `addFlags(Intent.FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS)`
    * Показывать уведомление при закрытии диалога, запущенного из фона
* [x] CaptchaRequest не использует альтернативные иконки уведомлений"
mosmetro-android/mosmetro-android,closed,Удаление mosmetro v1,[],"Домен login.wi-fi.ru разделегировали, так что, я думаю, стоит перестать использовать его как вариант обхода капчи в v2. 

```
drill login.wi-fi.ru @8.8.8.8
;; ->>HEADER<<- opcode: QUERY, rcode: NXDOMAIN, id: 11676
;; flags: qr rd ra ; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL
 0
;; QUESTION SECTION:
;; login.wi-fi.ru.      IN      A

;; ANSWER SECTION:

;; AUTHORITY SECTION:
wi-fi.ru.       1799    IN      SOA     ns1.reg.ru. hostmaster.ns1
reg.ru. 1495207846 14400 3600 604800 10800

;; ADDITIONAL SECTION:

;; Query time: 95 msec
;; SERVER: 8.8.8.8
```"
mosmetro-android/mosmetro-android,closed,Увеличить размер капчи,[],"По умолчанию картинка с кодом имеет очень небольшой размер, так что её довольно сложно прочитать."
mosmetro-android/mosmetro-android,closed,Диалог капчи отменяется при нажатии вне окна,[],"Из-за его внезапной природы это часто приводит к нежелательной отмене ввода кода, а приложение после этого уже не пытается подключиться снова."
mosmetro-android/mosmetro-android,closed,Иногда ветки обновления не прогружаются,"[Label(name=""bug"")]","Помогает только полная очистка данных приложения. Насчёт ожидания точно неизвестно, так что проблема может быть и не в кэше."
mosmetro-android/mosmetro-android,closed,F-Droid,[],Не возражает ли разработчик против размещения приложения на f-droid? 
mosmetro-android/mosmetro-android,closed,Добавить сеть CPPK_Free,"[Label(name=""algorithm""), Label(name=""report/google play"")]","Судя по сообщениям, сеть в пригородных поездах использует те же алгоритмы. Ручное подключение работает нормально, так что остаётся только добавить сеть в список."
mosmetro-android/mosmetro-android,closed,Повторная проверка,[],"Очень часто происходит такая ситуация что подключается все удачно. Можно открывать браузер и сразу пользоваться интернетом.
Но через несколько станций, если попытаться зайти на сайт, опять начинаются какие то редиректы и попадаешь на wifi.ru. Как будто сети разные и проверка делается заново.

Можно как то мониторить повторную проверку и пропускать заход на wifi.ru?

Xiaomi Redmi 4 Pro
1.7.5-57"
mosmetro-android/mosmetro-android,open,Добавить кнопку перезапуска на уведомления,"[Label(name=""enhancement"")]","Иногда приложение не замечает отсутствие доступа в интернет и не пытается переподключиться. В таких случаях было бы удобно вызвать принудительное переподключение прямо через уведомление. Кнопка ""Остановить"" у нас уже есть, так что добавить новую будет не так сложно."
mosmetro-android/mosmetro-android,closed,Капча не загружается,"[Label(name=""bug"")]","```
[+1020] Ошибка: не удалось загрузить изображение
[+0001] java.lang.Exception: Empty response: 200
	at pw.thedrhax.mosmetro.httpclient.clients.OkHttp.getInputStream(OkHttp.java:232)
	at pw.thedrhax.mosmetro.httpclient.Client$3.body(Client.java:126)
	at pw.thedrhax.mosmetro.httpclient.Client$3.body(Client.java:123)
	at pw.thedrhax.mosmetro.httpclient.Client$RetryOnException.run(Client.java:89)
	at pw.thedrhax.mosmetro.httpclient.Client.getInputStream(Client.java:128)
	at pw.thedrhax.mosmetro.activities.CaptchaDialog$2$1.doInBackground(CaptchaDialog.java:76)
	at pw.thedrhax.mosmetro.activities.CaptchaDialog$2$1.doInBackground(CaptchaDialog.java:71)
	at android.os.AsyncTask$2.call(AsyncTask.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:237)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
	at java.lang.Thread.run(Thread.java:818)
```

![image](https://cloud.githubusercontent.com/assets/6968908/25034945/05429440-20f3-11e7-8732-c1a1c489fa32.png)"
mosmetro-android/mosmetro-android,closed,Updating shortcut icons and other changes,[],"- Добавил линк в About
- Добавил поддержку устройств с длительным соотношением сторон. Google [призвал](https://android-developers.googleblog.com/2017/03/update-your-app-to-take-advantage-of.html) всех это сделать
- Изменил иконки ярлыков в материальный стиль
- Добавил значок для раздела ""Рекомендуемые"" в Google Play"
mosmetro-android/mosmetro-android,closed,Будут ли шоркаты для андроид 7,[],
mosmetro-android/mosmetro-android,closed,Updating notification icons and themes,[],"- исправление предыдущих PR

- новые иконки уведомлений"
mosmetro-android/mosmetro-android,closed,Перенаправление на рекламу после авторизации,"[Label(name=""algorithm"")]","Наконец-то удалось поймать перенаправление, которое иногда пытаются подсунуть на HTTP сайтах. Возможно, использование HTTP в проверке generate_204 позволит это обойти, так как перенаправление ленивое и не производит MITM-атаку.

```
GET / HTTP/1.1
Host: curlmyip.org
Connection: keep-alive
Upgrade-Insecure-Requests: 1
Save-Data: on
User-Agent: ...
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
DNT: 1
Accept-Encoding: gzip, deflate, sdch
Accept-Language: ru,en;q=0.8

HTTP/1.0 302 Found
Location: http://wi-fi.ru/midsession?mac=...&url=aHR0cDovL2N1cmxteWlwLm9yZy8=
Connection: close
Content-Length: 0
```"
mosmetro-android/mosmetro-android,closed,Возможное изменение алгоритма в метро??,[],"Захожу в метро, включаю wi-fi и подключилось к сети метро. Но интернета нет. Захожу в приложение, пишет что соединение есть, но на делу нету.
![screenshot_20170316-235905](https://cloud.githubusercontent.com/assets/19420334/24072626/f193c14c-0bfa-11e7-942e-7b735698d6ad.png)
![screenshot_20170316-235910](https://cloud.githubusercontent.com/assets/19420334/24072627/f193ef50-0bfa-11e7-87a0-9e275f1a0d6e.png)
Идет проверка..
![screenshot_20170317-005603](https://cloud.githubusercontent.com/assets/19420334/24072641/1d309bcc-0bfb-11e7-9d3a-183d61f6c247.png)
[pw.thedrhax.mosmetro.txt](https://github.com/TheDrHax/mosmetro-android/files/852475/pw.thedrhax.mosmetro.txt)
[pw.thedrhax.mosmetro.txt](https://github.com/TheDrHax/mosmetro-android/files/852476/pw.thedrhax.mosmetro.txt)
Приложил лог. Подключиться не удалось, смотрел рекламу
 "
mosmetro-android/mosmetro-android,closed,Добавить ссылки на donate на страницу проекта на github,[],Пришлось выужитвать адрес yandex.money из исходников
mosmetro-android/mosmetro-android,closed,Уведомление об Enforta моментально исчезает,"[Label(name=""bug"")]",
mosmetro-android/mosmetro-android,closed,Капча на МЦК вызывает ошибку,"[Label(name=""algorithm""), Label(name=""report/mail"")]","Судя по сообщениям, на МЦК начали менять алгоритм. Парсер из MosMetroV2 перестал распознавать капчу, поэтому он доходит до проверки соединения, где ожидается JSON ответ от сервера.

```
5 мар. 2017 г. 7:35:39
Определение провайдера…
Версия приложения: 1.7.4-55
Название алгоритма: MosMetroV2
Проверка доступа в интернет
<!doctype html>
<html>
 <head> 
  <meta charset=""utf-8""> 
  <title>wi-fi</title> 
  <meta http-equiv=""refresh"" content=""0;https://auth.wi-fi.ru?segment=mcc""> 
 </head> 
 <body>  
 </body>
</html>
https://auth.wi-fi.ru?segment=mcc
Получение перенаправления
<html>
 <head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-20dfe456eabaec4a528993f85133e16e68916b9695bff14949b872d845737d20.css"">
 </head>
 <body>
  <img class=""data_pixels"" src=""http://ads.adfox.ru/220463/getDefaultImage?p1=buxxf&amp;amp;p2=v"" alt=""Getdefaultimage?p1=buxxf&amp;amp;p2=v"">
  <img class=""data_pixels"" src=""http://ads.adfox.ru/220463/getCode?p1=buhvd&amp;amp;p2=v&amp;amp;pe=b&amp;amp;pfc=bezbz&amp;amp;pfb=dksmt&amp;amp;pr=eslgyih"" alt=""Getcode?p1=buhvd&amp;amp;p2=v&amp;amp;pe=b&amp;amp;pfc=bezbz&amp;amp;pfb=dksmt&amp;amp;pr=eslgyih"">
  <img class=""data_pixels"" src=""http://top-fwz1.mail.ru/counter?id=701848;js=na"" alt=""Counter?id=701848;js=na"">
  <img class=""data_pixels"" src=""http://banners.adfox.ru/transparent.gif"" alt=""Transparent"">
  <div class=""no-js-view"">
   <div class=""error-view"" style=""display: block;"">
    <h1 class=""message"">In order to continue, enable JavaScript execution in current browser</h1>
   </div>
  </div>
 </body>
</html>
Получение страницы авторизации
<!DOCTYPE html PUBLIC ""-//W3C//DTD XHTML 1.0 Transitional//EN"" ""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"">
<html class=""no-js"">
 <head>
  <meta charset=""utf-8"">
  <meta content=""IE=edge"" http-equiv=""X-UA-Compatible"">
  <meta content=""text/html; charset=UTF-8"" http-equiv=""Content-Type"">
  <meta content=""no-cache,no-store,must-revalidate"" http-equiv=""Cache-Control"">
  <meta content=""no-cache"" http-equiv=""Pragma"">
  <meta content=""-1"" http-equiv=""Expires"">
  <meta content=""noindex, nofollow"" name=""robots"">
  <meta content=""always"" name=""referrer"">
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link href=""/favicon.ico"" rel=""icon"" type=""image/x-icon"">
  <link href=""/favicon.ico"" rel=""shortcut icon"" type=""image/x-icon"">
  <title>Wi-Fi Authorization</title>
  <meta content=""JSC “MaximaTelecom”"" name=""author"">
  <meta name=""csrf-param"" content=""authenticity_token""> 
  <meta name=""csrf-token"" content=""ECTO7q4sjCp1YAsc2U3L5y11i7eYqNummaM0yRr2Fe8CAwl4IxacUfJpAneuIyWx2c4THnrjCtkhYtschCctBQ=="">
 </head>
 <body>
  <div id=""app""></div>
 </body>
</html>
Отправка формы авторизации
<html>
 <head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-20dfe456eabaec4a528993f85133e16e68916b9695bff14949b872d845737d20.css"">
 </head>
 <body>
  <div class=""branding-header"" style=""z-index: 5 !important"">
   <a class=""header-item"" href=""http://login.wi-fi.ru/docs/offers/offer_auth.pdf"">
    <div class=""branding-header__offer"">
     By pressing “Connect” you accept the user agreement terms.
    </div></a>
   <a class=""header-item"" href=""http://login.wi-fi.ru/vmetro/faq?lang=ru"">
    <div class=""branding-header__support"">
     Support
    </div></a>
   <a class=""header-item"" href=""/auto_auth?lang=ru&amp;segment=metro"">
    <div class=""branding-header__lang russian"">
     Русский
    </div></a>
  </div>
  <div class=""auto-auth-view"">
   <div class=""content"">
    <div class=""message"">
     Уважаемый пользователь.
     <br>Возможно, на Вашем устройстве установлено программное обеспечение, производящее автоматическую авторизацию, что противоречит «Условиям пользования Услугами». Для доступа к сети Интернет Вам необходимо удалить данную программу или внести корректировки в настройки браузера. Для автоматического подключения и доступа к сети Интернет без просмотра рекламы Вы можете подключить Услугу&nbsp;
     <a href=""https://pay.wi-fi.ru"">«Как&nbsp;дома»</a>. Если данное сообщение Вы получили по ошибке, то введите код с картинки ниже.
    </div>
   </div>
   <form class=""captcha__container"" action=""/auto_auth?segment=metro"" accept-charset=""UTF-8"" method=""post"">
    <input name=""utf8"" type=""hidden"" value=""✓"">
    <input type=""hidden"" name=""authenticity_token"" value=""/laAhDxnJoq2Y3CGL7uwd8Mk4L5IGCnHKw3gEUsKgF3scUcSsV028TFqee1Y1V4hN594F6pT+LiTzA/E1du4tw=="">
    <img class=""captcha__image"" alt=""Captcha"" src=""/rucaptcha/"">
    <div class=""captcha__controls"">
     <input class=""captcha__input form-control"" placeholder=""Введите текст с картинки"" name=""_rucaptcha"" type=""text"" autocorrect=""off"" autocapitalize=""off"" pattern=""[0-9a-z]*"" maxlength=""4"" autocomplete=""off"">
     <input type=""submit"" name=""commit"" value=""OK"" class=""captcha__submit"" data-disable-with=""OK"">
    </div>
   </form>
  </div>
 </body>
</html>
Проверка доступа в интернет
Unexpected character (<) at position 0.
	at org.json.simple.parser.Yylex.yylex(Yylex.java:610)
	at org.json.simple.parser.JSONParser.nextToken(JSONParser.java:269)
	at org.json.simple.parser.JSONParser.parse(JSONParser.java:118)
	at org.json.simple.parser.JSONParser.parse(JSONParser.java:81)
	at org.json.simple.parser.JSONParser.parse(JSONParser.java:75)
	at pw.thedrhax.mosmetro.authenticator.providers.MosMetroV2$10.run(MosMetroV2.java:354)
	at pw.thedrhax.mosmetro.authenticator.Provider.start(Provider.java:230)
	at pw.thedrhax.mosmetro.services.ConnectionService.connect(ConnectionService.java:228)
	at pw.thedrhax.mosmetro.services.ConnectionService.main(ConnectionService.java:334)
	at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent(ConnectionService.java:290)
	at android.app.IntentService$ServiceHandler.handleMessage(IntentService.java:67)
	at android.os.Handler.dispatchMessage(Handler.java:102)
	at android.os.Looper.loop(Looper.java:154)
	at android.os.HandlerThread.run(HandlerThread.java:61)
```"
mosmetro-android/mosmetro-android,closed,Updated themes and a small change,[],"- Раскрасил уведомления (с api24 так можно)
- Добавил кнопки назад в некоторых меню
- Добавил файл цветовой схемы и добавил переменные
- Добавил цвет акцента для диалоговых окон
- Добавил векторные иконки (но тут это работает с api21 либо можно использовать [BetterVectorDrawable](https://github.com/a-student/BetterVectorDrawable))
- Изменил метод переключения некоторых настроек, дабы показать их важность (с чекбокса на свитч)"
mosmetro-android/mosmetro-android,closed,Нужна ли в приложении проверка wi-fi? ,[],"Можно было прикрутить SnackBar с оповещением если зашел в приложение, а wi-fi не включил (интересно у меня одного такое было?) но SnackBar доступен только с api23..(или support-compat уже умеет это на других версиях?)"
mosmetro-android/mosmetro-android,closed,Максимально ускорить завершение Provider,"[Label(name=""enhancement"")]","* [x] Убрать лишние задачи из основного потока Provider.start() (#127)
* [x] Добавить возможность прерывания запроса в OkHttp
* [x] Реализовать каскадное прерывание ConnectionService - Provider - Client и ему подобные
* [x] Проверять значение переменной `running` в продолжительных задачах"
mosmetro-android/mosmetro-android,closed,Запускать NewsChecker и подобные задачи асинхронно,"[Label(name=""enhancement"")]","NewsChecker может сильно тормозить общее выполнение алгоритма. Это проявляется в зависании выполнения в самом конце, когда уведомление уже показывает 100%."
mosmetro-android/mosmetro-android,closed,Угадывать провайдера при неудачном его определении,"[Label(name=""enhancement"")]","Необходимо свести к минимуму появление уведомления ""Сеть не поддерживается"". Так как в 95% случаев провайдером является MosMetroV2, лучше до конца предполагать его вместо выдачи ошибки."
mosmetro-android/mosmetro-android,closed,"Обратное действие опции ""Альтернативные иконки"" для Android < 5","[Label(name=""enhancement"")]","Изначально я не подумал о том, что помимо желающих включить цветные иконки уведомлений на Android 5 есть также и желающие включить белые иконки на Android 4. Нужно исправить этот недочёт :)"
mosmetro-android/mosmetro-android,closed,ANR в главном меню при смене состояния Wi-Fi,"[Label(name=""bug""), Label(name=""report/mail"")]","Один из пользователей сообщает, что приложение может надолго подвиснуть в главном меню. Судя по всему, это происходит во время старта/остановки фонового процесса. Такие вещи не стоит упускать, так что лучше проверить все операции, которые выполняются в UI-потоке."
mosmetro-android/mosmetro-android,closed,"Удалить или скрыть иконку рядом с кнопкой ""Остановить"" в уведомлениях","[Label(name=""bug""), Label(name=""report/mail"")]","На эмуляторе не было видно, для чего нужна эта иконка, а вот у многих она проявилась.

![screenshot-21 09 57-01 03 17](https://cloud.githubusercontent.com/assets/6968908/23474201/fabeded0-fec3-11e6-8db4-27531f4ce89e.png)

[Строка, где присваивается иконка](https://github.com/TheDrHax/mosmetro-android/blob/55/src/pw/thedrhax/mosmetro/services/ConnectionService.java#L95)"
mosmetro-android/mosmetro-android,closed,Add color Accent and update description for Google Play,[],
mosmetro-android/mosmetro-android,closed,New launcher icon and design theme,[],
mosmetro-android/mosmetro-android,closed,DebugActivity перехватывает фокус при изменении лога и закрывает почтовый клиент,"[Label(name=""bug""), Label(name=""report/mail"")]","Собственно, название полностью описывает проблему. Скорее всего, нужно в onPause() удалять callback из Logger, чтобы лог не мог обновляться в фоне. А в onResume() можно полностью перезагружать лог из фона и снова регистрировать callback."
mosmetro-android/mosmetro-android,closed,Проблема с вводом капчи,[],"Сколько раз вылезал запрос на капчу - вводил верно(я не робот, честно) - постоянно вылезал повторный запрос. Помогало только открыть в браузере любую ссылку по http, дождаться окна авторизации в wifi и там уже вводить капчу. 

Что следует сделать, предоставить для полной отчетности, для того случая, когда в следующий раз столкнусь с таким?"
mosmetro-android/mosmetro-android,closed,Клавиатура при вводе капчи в landscape режиме закрывает весь экран,[],"В портретной ориентации все ок, видно одновременно клавиатуру и капчу, а в альбомной клавиатура занимает весь экран."
mosmetro-android/mosmetro-android,closed,Вылет при попытке открыть ссылку без установленного браузера,"[Label(name=""bug""), Label(name=""report/google play"")]","Проблема, аналогичная #116. Система не может найти Activity для открытия ссылки.

```
android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.intent.action.VIEW dat=https://thedrhax.pw }
	at android.app.Instrumentation.checkStartActivityResult(Instrumentation.java:1765)
	at android.app.Instrumentation.execStartActivity(Instrumentation.java:1485)
	at android.app.Activity.startActivityForResult(Activity.java:3810)
	at android.app.Activity.startActivityForResult(Activity.java:3752)
	at android.app.Activity.startActivity(Activity.java:4081)
	at android.app.Activity.startActivity(Activity.java:4049)
	at android.preference.Preference.performClick(Preference.java:1001)
	at android.preference.PreferenceScreen.onItemClick(PreferenceScreen.java:214)
	at android.widget.AdapterView.performItemClick(AdapterView.java:300)
	at android.widget.AbsListView.performItemClick(AbsListView.java:1143)
	at android.widget.AbsListView$PerformClick.run(AbsListView.java:3048)
	at android.widget.AbsListView$3.run(AbsListView.java:3837)
	at android.os.Handler.handleCallback(Handler.java:739)
	at android.os.Handler.dispatchMessage(Handler.java:95)
	at android.os.Looper.loop(Looper.java:135)
	at android.app.ActivityThread.main(ActivityThread.java:5261)
	at java.lang.reflect.Method.invoke(Native Method)
	at java.lang.reflect.Method.invoke(Method.java:372)
	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:939)
	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:734)
```"
mosmetro-android/mosmetro-android,closed,Вылет при попытке запроса на игнорирование энергосбережения,"[Label(name=""external bug""), Label(name=""report/google play"")]","Многие пользователи, в том числе с Xiaomi (как обычно), столкнулись с тем, что диалог, который показывается при первом запуске приложения, приводил к вылету при попытке добавить приложение в белый список энергосбережения.

Скорее всего, эта проблема специфична для определённых прошивок, так что нам нужно обработать это исключение и прекратить предлагать эту функцию в будущем, если ошибка всё-таки произошла.

```
android.content.ActivityNotFoundException: No Activity found to handle Intent { act=android.settings.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS dat=package:pw.thedrhax.mosmetro }
	at android.app.Instrumentation.checkStartActivityResult(Instrumentation.java:1878)
	at android.app.Instrumentation.execStartActivity(Instrumentation.java:1545)
	at android.app.Activity.startActivityForResult(Activity.java:4283)
	at android.app.Activity.startActivityForResult(Activity.java:4230)
	at android.app.Activity.startActivity(Activity.java:4567)
	at android.app.Activity.startActivity(Activity.java:4535)
	at pw.thedrhax.util.PermissionUtils.requestBatterySavingIgnore(PermissionUtils.java:53)
	at pw.thedrhax.mosmetro.activities.SettingsActivity$6.onClick(SettingsActivity.java:191)
	at com.android.internal.app.AlertController$ButtonHandler.handleMessage(AlertController.java:173)
	at android.os.Handler.dispatchMessage(Handler.java:102)
	at android.os.Looper.loop(Looper.java:158)
	at android.app.ActivityThread.main(ActivityThread.java:7224)
	at java.lang.reflect.Method.invoke(Native Method)
	at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:1230)
	at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1120)
```"
mosmetro-android/mosmetro-android,closed,Подключение зависает на определении провайдера,"[Label(name=""bug"")]","Многие пользователи жалуются на то, что приложение очень долго определяет провайдера. Этот процесс может вообще не завершиться. Скорее всего, проблемы в самой сети или подключении к ней, но мы можем нормально прервать процесс и сообщить об ошибке."
mosmetro-android/mosmetro-android,open,Обновление алгоритмов из приложения,[],"Алгоритмы загружаются/обновляются из репозитория по мере появления или по запросу, тем самым избавившись от частого скачивания и установки apk файла."
mosmetro-android/mosmetro-android,closed,Сделать timeout для запросов опциональным,"[Label(name=""enhancement"")]","Специфика работы местных сетей Wi-Fi приводит к тому, что у некоторых пользователей подключение намертво зависает. При этом введение таймаута, как оказалось, приводит к срыву запросов у других пользователей, хотя в браузере подключение возможно.

В общем, надо сделать таймаут отключённым по умолчанию."
mosmetro-android/mosmetro-android,closed,Маскировать foreground-уведомление под неудаляемые уведомления,"[Label(name=""enhancement"")]","Два постоянных уведомления довольно сильно раздражают, поэтому можно автоматически привязывать фоновый процесс к постоянному уведомлению, которое отображается в данный момент. Например, уведомление об успехе идеально подошло бы для этой задачи, если его удаление не разрешено пользователем.

![](https://pp.vk.me/c836632/v836632392/289b0/aqQAA-ENyGE.jpg)"
mosmetro-android/mosmetro-android,closed,Несколько ConnectionService запускаются параллельно,"[Label(name=""bug"")]","После ввода единого логгера удалось выяснить, что ConnectionService может запускать несколько onHandleIntent() одновременно. Так это или нет, пока не ясно, но в логах часто возникают ситуации, когда строки из Provider дублируются. А судя по разным CSRF-токенам в ответах сервера, в фоне работают сразу несколько объектов класса Provider.

```
Отправка формы авторизации
Отправка формы авторизации
<html>
<head></head>
<body>
  {""result"":true,""user_mac"":""..."",""auth_status"":""initial"",""auth_error_code"":null}
</body>
</html>
<html>
<head></head>
<body>
  {""result"":true,""user_mac"":""..."",""auth_status"":""initial"",""auth_error_code"":null}
</body>
</html>
Проверка доступа в интернет
Проверка доступа в интернет
Соединение успешно установлено :3
Соединение успешно установлено :3
16 февр. 2017 г. 15:30:52
16 февр. 2017 г. 15:30:52
```"
mosmetro-android/mosmetro-android,closed,Возможность переключения языка,"[Label(name=""enhancement"")]","Некоторые пользователи с английской версией Android недовольны тем, что приложение тоже стало английским. Нужно предоставить возможность сменить язык приложения в настройках."
mosmetro-android/mosmetro-android,closed,Не останавливать ConnectionService при запросе капчи через уведомление,"[Label(name=""enhancement"")]","Так как ввод капчи теперь реализован через Activity, а результат возвращается через Broadcast Intent, мы можем запускать диалог ввода капчи прямо из уведомления вместо запуска DebugActivity и повторного прохода по алгоритму. Ожидание в фоне уже может прерываться удалением этого уведомления, так что пользователь может отказаться от ввода капчи и процесс просто завершится без лишнего шума.

Также это позволит избавиться от уведомления о капче, которое сейчас не удаляется после остановки фонового процесса. Можно весь день ездить с телефоном в кармане, а под вечер заметить, что нужно было ввести капчу."
mosmetro-android/mosmetro-android,closed,Replacing icons and cosmetic improvements,[],"## * Обновил иконки
 - нарисовал лаунчер иконку по гайдлайнам
 - заменил экшен-бар иконки по гайдлайнам
 - перенес  лаунчер иконки в папку mipmap
 - так же добавил иконку для Google Play

## * Обновил README.md
 - добавил кнопку загрузки Google Play
 - добавил сведения о лицензии

## * Создал папку .github
 - перенес не важные файлы
 - так же можно создать удобные шаблоны баг-репортов"
mosmetro-android/mosmetro-android,closed,Возможный miscopy,[],"Кажется, [данная строка](https://github.com/TheDrHax/mosmetro-android/blob/master/src/pw/thedrhax/mosmetro/activities/AboutActivity.java#L67) – лишняя. Есть ли особый смысл в вызове метода `executePendingTransactions()`?"
mosmetro-android/mosmetro-android,closed,Fully removed reflection from the codebase.,[],"В данном PR представлены:

- Отдельный модуль `mosmetro-app` с общим build.gradle. Это нужно для того, чтобы представить модуль, который будет генерировать код и модуль, который будет содержать аннотацию `@Matchable`.
- Модуль `mosmetro-app-compiler`, генерирующий код для выбора `Provider`.
- Модуль `mosmetro-app-annotation-api`, содержащий аннотацию для использования в двух вышеупомянутых проектах.

То есть, сейчас уже есть три модуля:

1. `mosmetro-app`
2. `mosmetro-app-compiler`
3. `mosmetro-app-annotation-api`

Кроме того, добавлены файлы gradle. Это нужно для того, чтобы человек, скачивающий репозиторий, пользовался именно той версией сборщика, что и создатель проекта.

В папке `\mosmetro-android\mosmetro-app-compiler\src\test\java\pw\thedrhax\mosmetro\MatchableProcessorTest.java` написаны тесты для модуля `mosmetro-app-compiler`, поэтому при сборке APK желательно их все прогонять. То есть, команда для сборки APK должна быть примерно такой: `gradlew clean build connectedAndroidTest -PdisablePreDex --stacktrace`."
mosmetro-android/mosmetro-android,closed,Изменение алгоритма MosMetro v2,"[Label(name=""algorithm"")]","Утром 18 января было замечено, что началось тестирование нового алгоритма, который определяется как MosMetroV2, но имеет другой адрес перенаправления. Всего поступило две жалобы, в то время как по поводу капчи продолжали приходить письма.

Судя по ответу сервера, теперь проверяется наличие каких-то Cookies, что не должно быть особой проблемой. Скорее всего, это получится реализовать прямо в MosMetroV2, но в крайнем случае можно создать и MosMetroV3.

```
17 янв. 2017 г. 8:20:16 AM
Определение названия сети
Поиск подходящего алгоритма для сети MosMetro_Free
Версия приложения: 1.7.2-50
Подключение к сети MosMetro_Free
Проверка доступа в интернет
<html>
<head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://auth.wi-fi.ru/identification?segment=metro"">
</head>
<body>
</body>
</html>
http://auth.wi-fi.ru/identification?segment=metro
Версия алгоритма: 2
Получение страницы авторизации
<html>
<head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-20dfe456eabaec4a528993f85133e16e68916b9695bff14949b872d845737d20.css"">
</head>
<body>
  <div class=""branding-header"" style=""z-index: 5 !important"">
   <a class=""header-item"" href=""http://login.wi-fi.ru/docs/offers/offer_auth.pdf"">
    <div class=""branding-header__offer"">
     By pressing “Connect to the Internet” you accept the user agreement terms.
    </div></a>
   <a class=""header-item"" href=""http://login.wi-fi.ru/vmetro/faq?lang=ru&amp;client_mac="">
    <div class=""branding-header__support"">
     Support
    </div></a>
   <a class=""header-item"" href=""/warn/cookies?lang=ru"">
    <div class=""branding-header__lang russian"">
     Русский
    </div></a>
  </div>
  <div class=""auto-auth-view"">
   <div class=""content"">
    <div class=""message"">
     Sorry, an error occurred
     <br>
     <br>In order to continue, enable Cookies support in current browser.
     <br>Please, try again or follow the
     <a href=""/"">link</a>.
    </div>
   </div>
  </div>
</body>
</html>
<html>
<head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-20dfe456eabaec4a528993f85133e16e68916b9695bff14949b872d845737d20.css"">
</head>
<body>
  <div class=""branding-header"" style=""z-index: 5 !important"">
   <a class=""header-item"" href=""http://login.wi-fi.ru/docs/offers/offer_auth.pdf"">
    <div class=""branding-header__offer"">
     By pressing “Connect to the Internet” you accept the user agreement terms.
    </div></a>
   <a class=""header-item"" href=""http://login.wi-fi.ru/vmetro/faq?lang=ru&amp;client_mac="">
    <div class=""branding-header__support"">
     Support
    </div></a>
   <a class=""header-item"" href=""/warn/cookies?lang=ru"">
    <div class=""branding-header__lang russian"">
     Русский
    </div></a>
  </div>
  <div class=""auto-auth-view"">
   <div class=""content"">
    <div class=""message"">
     Sorry, an error occurred
     <br>
     <br>In order to continue, enable Cookies support in current browser.
     <br>Please, try again or follow the
     <a href=""/"">link</a>.
    </div>
   </div>
  </div>
</body>
</html>
Отправка формы авторизации
java.lang.Exception: Meta tag not found
at pw.thedrhax.mosmetro.httpclient.Client.parseMetaContent(Client.java:118)
at pw.thedrhax.mosmetro.authenticator.networks.MosMetro.connect(MosMetro.java:215)
at pw.thedrhax.mosmetro.authenticator.Authenticator.start(Authenticator.java:69)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:151)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:128)
at android.os.AsyncTask$2.call(AsyncTask.java:295)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:234)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1113)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:588)
at java.lang.Thread.run(Thread.java:818)

Ошибка: сервер не ответил или вернул ошибку
17 янв. 2017 г. 8:20:16 AM
```"
mosmetro-android/mosmetro-android,closed,Introduced a separate 'mosmetro-app' module.,[],"В данном PR представлен отдельный модуль 'mosmetro-app' с общим `build.gradle`. Это нужно для того, чтобы представить модуль, который будет генерировать код и модуль, который будет содержать аннотацию `@Matchable`. То есть, всего впоследствии будет три модуля:

1. mosmetro-app
2. mosmetro-app-annotation-api
3. mosmetro-app-compiler

Кроме того, добавлены файлы gradle. Это нужно для того, чтобы человек, скачивающий репозиторий, пользовался именно той версии сборщика, что и создатель проекта."
mosmetro-android/mosmetro-android,open,Избавиться от рефлексии в Provider,[],"Здесь две задачи:

- [ ] Реорганизовать проект так, чтобы был общий `build.gradle`.
- [ ] Применить Annotation Processing в Java. Пометить все методы `match()` `@Matchable` (например) и генерировать отдельный класс со статическим методом, который будет в зависимости от `*.class` обращаться в какому-либо методу напрямую без рефлексии."
mosmetro-android/mosmetro-android,open,Убрать все lint issues,[],
mosmetro-android/mosmetro-android,closed,Captcha EditText now accepts only alphanumeric chars.,[],Fully closes 5th task in #74.
mosmetro-android/mosmetro-android,closed,Extracted constants to BuildConfig.,[],
mosmetro-android/mosmetro-android,closed,Switched Thread.sleep() to SystemClock.sleep().,[],
mosmetro-android/mosmetro-android,closed,Updated links to files in README.md.,[],
mosmetro-android/mosmetro-android,closed,Refactored AndroidManifest.,[],"Removed unnecessary attributes.
Fixed XML folding.
Fixed lint issues."
mosmetro-android/mosmetro-android,closed,Make AndroidManifest great again.,[],
mosmetro-android/mosmetro-android,closed,Overall code improvements.,[],"1. Refactored all utility classes.
2. Introduced `androidTest` and `test` build variants for functional and unit testing respectively.
3. Added proguard to the project in order to strip out unused code.
4. Added unit tests to check if the utility classes are well-defined.
5. Added `@NonNull` annotation to variables in constructors.
6. Started to move towards immutability (defining final variables in classes).

P.S. If you like this pull request, I would really love to improve more of your code!
P.P.S. Thanks for the app!"
mosmetro-android/mosmetro-android,closed,Реализовать постоянный фоновый процесс,"[Label(name=""enhancement"")]","Так как особых улучшений на устройствах с MiUI и другими глючными оболочками не предвидится, а отрицательных отзывов от таких пользователей в последнее время всё больше (обладатели Xiaomi — самые активные комментаторы в Google Play), нужно реализовать фоновый процесс, который будет закрепляться в памяти при загрузке устройства или при открытии приложения.

* Чтобы исключить убийство этого процесса при нехватке памяти, нужно закрепить его через постоянное уведомление ([startForeground](https://developer.android.com/guide/components/services.html#Foreground)).

* Фоновый процесс должен отслеживать сеть через WifiUtils и/или отлавливать Broadcast Intent с состоянием Wi-Fi через динамический Receiver.

* Эта функция должна быть полностью опциональной. Включаться по умолчанию она должна только на устройствах Xiaomi.

Связанное обсуждение: #58."
mosmetro-android/mosmetro-android,closed,Поддержка Air_WiFi_Free во Внуково,"[Label(name=""algorithm"")]","Только что мне сообщили, что в аэропорту Внуково есть сеть, которая работает аналогично остальным сетям (через http://wi-fi.ru). Можно добавить её так же, как и AURA.

![2016-12-22 21-36-55](https://cloud.githubusercontent.com/assets/6968908/21436402/52a86122-c88f-11e6-862a-2f1a9ed60b43.png)
"
mosmetro-android/mosmetro-android,closed,Лицензия,[],"У приложения не указана лицензия кроме файла LICENSE с копией GPLv2. Зависимости json-simple и OkHttp распространяются под Apache 2.0, которая не совместима с GPLv2:
https://www.gnu.org/licenses/license-list.html#apache2
https://www.apache.org/licenses/GPL-compatibility.html

Нужно либо GPLv3 сделать с указанием в исходниках GPLv3 or any other later version, либо ISC/MIT/UNLICENSE.

В текущем виде приложение не получится залить, например, на F-Droid."
mosmetro-android/mosmetro-android,closed,[Gradle] Приложение не опознаёт SSID,"[Label(name=""bug"")]","По последним нескольким сборкам ветки master поступило несколько жалоб по поводу того, что приложение не реагирует на поддерживаемые сети. Проблема присутствует на всех сборках -signed.apk, однако сборки -debug.apk работают по-прежнему. Внезапное появление жалоб и такая разница между сборками одной и той же ревизии кода позволяет предположить, что виновата система сборки Gradle, появившаяся после PR #84 в сборке [master-#142](https://local.thedrhax.pw/jenkins/job/MosMetro-Android/job/master/142/)."
mosmetro-android/mosmetro-android,closed,Рефакторинг Authenticator,"[Label(name=""algorithm""), Label(name=""enhancement"")]","После перехода на единую сеть MT_FREE возникла такая проблема: приложение не может определить провайдера Enforta, так как класс MosMetro этого не умеет (а MT_FREE является его потомком). При этом сделать MT_FREE потомком MosGorTrans нельзя, так как он не захочет работать с кем-то кроме Netynet или Enforta.

Также среди потомков Authenticator много классов-заглушек для поддержи одной и той же сети с разными названиями (MosMetro_Free, AURA, Air_WiFi_Free и MT_FREE, например). На данный момент приложению известно только две версии одного и того же алгоритма MosMetro, на котором основаны все 4 сети.

Я давно планировал совершить переход с группировки по SSID на группировку по провайдерам, т.к. можно будет полностью разделить механизм срабатывания на определённые SSID и определение алгоритма для каждого из них.

Почти все известные провайдеры и соответствующие им SSID описаны в файле [README.md](https://github.com/TheDrHax/mosmetro-android/blob/master/README.md)."
mosmetro-android/mosmetro-android,closed,Update README to reflect transition to Gradle,[],
mosmetro-android/mosmetro-android,closed,English translation,[],Fix for issue #61
mosmetro-android/mosmetro-android,closed,Translation,[],Fix for issue #61 
mosmetro-android/mosmetro-android,closed,Android Doze whitelisting,"[Label(name=""enhancement""), Label(name=""external bug"")]","В новых версиях Android (вообще, с 6.0, но у меня с 7.1) было добавлено агрессивное энергосбережение, которое может превзойти даже MiUI. Благо, для нас оставили возможность запросить у пользователя разрешение на добавление в белый список.

Возможное решение: http://stackoverflow.com/a/32627788"
mosmetro-android/mosmetro-android,closed,Удалить файлы .idea,[],"По-моему директории .idea не место в репозитории. Например, там настройки UI designer.

После переезда на gradle (см. #84 ) достаточно удалить .idea и сделать ""import project"" в Android Studio. Те же самые файлы .idea появляются с правильными ссылками на скрипт сборки и запуск через adb отлично работает."
mosmetro-android/mosmetro-android,closed,Migrate from Ant to Gradle,[],"Теперь собирается с помощью `gradle build`. `gradlew` добавлять не стал, потому что `gradle` и так легко поставить, зато наоборот удалил все .jar с либами и сделал ссылки на зависимости."
mosmetro-android/mosmetro-android,closed,Replace ellipsis with ellipsis character to fix lint error,[],"Исправил простейшую из ошибок, найденных Android Lint"
mosmetro-android/mosmetro-android,closed,Фоновый процесс зависает на Android 7.1.1,"[Label(name=""bug"")]","Наконец-то мне удалось обновиться до Cyanogen OS 14.1 и я сразу же поймал этот баг. О нём упоминали многих пользователи Android 7.1.

Уведомление остаётся при отключении от сети и его нельзя удалить, если это не было настроено заранее. Отключение автоматики в настройках убивает фоновый процесс и уведомление исчезает, т.е. это зависает именно фоновый процесс, а не само уведомление.

Баг проявляется не всегда, что затрудняет его поиск."
mosmetro-android/mosmetro-android,closed,Сделать привязку к сети отключаемой,"[Label(name=""enhancement"")]","Добавленная в #49 привязка процесса к определённой сети не только работает, но и может вызывать проблемы у тех, кто использует VPN. Если VPN подключается или отключается во время работы приложения, оно не сможет получить доступ к интернету до следующего запуска. Так как пользователей VPN среди нас не так много, можно сделать эту настройку отключаемой."
mosmetro-android/mosmetro-android,closed,Нет уведомления об успехе для MT_FREE,"[Label(name=""bug"")]","Скорее всего, дело в методе isWifiConnected() в ConnectionService."
mosmetro-android/mosmetro-android,closed,Обрабатывать ошибку 5XX,"[Label(name=""algorithm"")]","Алгоритм MosMetro v2 иногда ловит следующую ошибку и прерывается:

```
Получение страницы авторизации
<!doctype html>
<html>
<head>
  <title>We're sorry, but something went wrong (500)</title>
  <meta name=""viewport"" content=""width=device-width,initial-scale=1""> 
</head>
<body>
  <!-- This file lives in public/500.html -->
  <div class=""dialog"">
   <div>
    <h1>We're sorry, but something went wrong.</h1>
   </div>
   <p>If you are the application owner check the logs for more information.</p>
  </div>  
</body>
</html>
<!doctype html>
<html>
<head>
  <title>We're sorry, but something went wrong (500)</title>
  <meta name=""viewport"" content=""width=device-width,initial-scale=1""> 
</head>
<body>
  <!-- This file lives in public/500.html -->
  <div class=""dialog"">
   <div>
    <h1>We're sorry, but something went wrong.</h1>
   </div>
   <p>If you are the application owner check the logs for more information.</p>
  </div>  
</body>
</html>
```"
mosmetro-android/mosmetro-android,closed,"Не отображать stack trace, если ""Уже подключено""","[Label(name=""enhancement"")]","Этот stack trace постоянно вводит всех в заблуждение. Чтобы постоянно не приходилось объяснять принципы проверки соединения без использования сторонних серверов, можно удалить расширенный текст ошибки из лога.

```
Проверка доступа в интернет
java.lang.Exception: Meta tag not found
    at pw.thedrhax.mosmetro.httpclient.Client.parseMetaContent(Client.java:118)
    at pw.thedrhax.mosmetro.httpclient.Client.parseMetaRedirect(Client.java:126)
    at pw.thedrhax.mosmetro.authenticator.networks.MosMetro.isConnected(MosMetro.java:265)
    at pw.thedrhax.mosmetro.authenticator.networks.MosMetro.connect(MosMetro.java:58)
    at pw.thedrhax.mosmetro.authenticator.Authenticator.start(Authenticator.java:69)
    at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:142)
    at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:119)
    at android.os.AsyncTask$2.call(AsyncTask.java:292)
    at java.util.concurrent.FutureTask.run(FutureTask.java:237)
    at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
    at java.lang.Thread.run(Thread.java:818)

Уже подключено 
```"
mosmetro-android/mosmetro-android,closed,[1.7.1-48] Уведомление о капче не появляется,"[Label(name=""bug"")]","При неудачной попытке обхода капчи, приложение не выдаёт уведомление о том, что требуется ввод кода с картинки. Возможно, где-то в коде есть момент, который я упустил."
mosmetro-android/mosmetro-android,closed,Поддержка сети MT_FREE,"[Label(name=""algorithm""), Label(name=""enhancement"")]","Судя по [новостям](http://wi-fi.ru/desktop/news/7/1482507) все сети в будущем объединятся в сеть MT_FREE, которая будет доступна в метро, на МЦК и в наземном транспорте. Нужно добавить этот SSID в список поддерживаемых.

AURA, которую переименовали в MT_FREE, пока что останется в списке, так как она ещё может встречаться в некоторых местах.

* [x] Не учитывать регистр SSID (MT_Free / MT_FREE)
* [x] Добавить класс MT_FREE аналогично классу AURA"
mosmetro-android/mosmetro-android,closed,Добавить автоматическое распознавание капчи,[],"- [ ]  Собрать примеры капч

- [ ]  Фильтрация

- [ ]  Бинаризация

- [ ]  Сегментация

- [ ]  Распознавание сегментов

- [ ]  Аггрерированние"
mosmetro-android/mosmetro-android,closed,Доработка диалога ввода капчи,"[Label(name=""bug""), Label(name=""enhancement"")]","* [x] Диалог исчезает при смене ориентации экрана
* [x] Сделать кнопку перезагрузки капчи
* [x] Открывать диалог прямо из фонового сервиса
* [x] Запускать фоновый сервис после ввода капчи
* [x] Вызывать клавиатуру, содержащую цифры и латинские буквы: **удалось только отключить автокоррекцию**."
mosmetro-android/mosmetro-android,closed,Перейти на JSON API вместо подобия XML для получения обновлений,"[Label(name=""enhancement"")]","Наследие тех времён, когда уже была библиотека JSoup, но ещё не было json-simple.

Что нужно сделать:
* [x] Перейти на JSON (как в NewsChecker)
* [x] Получать информацию по HTTPS
    * [x] Let's Encrypt

Вы только посмотрите на этот ужас:
```xml
$ curl http://wi-fi.metro-it.com/update.php
<branch id=""play""><key id=""version"">45</key><key id=""build"">0</key><key id=""by_build"">0</key><key id=""url"">http://wi-fi.metro-it.com/update.php?download=play</key><key id=""message"">Версия 1.7-45:<br />
* Обновление алгоритма MosMetro v2 (18.11.16)<br />
* Устойчивость к неправильным настройкам<br />
<br />
Версия 1.7-44:<br />
+ Возможность переноса на SD-карту<br />
<br />
Версия 1.7-43:<br />
+ Добавлена строгая проверка интернета (отлючена по умолчанию)<br />
* Попытка исправить утечку пакетов через мобильную сеть<br />
<br />
Версия 1.7-42:<br />
+ Поддержка MosGorTrans_Free в транспорте<br />
+ Автоматическое добавление версии приложения в тему отчёта<br />
* Отображение версии приложения в кратком логе<br />
* Сборка проекта под Android 7.1 (API 25)</key></branch><branch id=""beta""><key id=""version"">45</key><key id=""build"">0</key><key id=""by_build"">0</key><key id=""url"">http://wi-fi.metro-it.com/update.php?download=beta</key><key id=""message"">Версия 1.7-45:<br />
* Обновление алгоритма MosMetro v2 (18.11.16)<br />
* Устойчивость к неправильным настройкам<br />
<br />
Версия 1.7-44:<br />
+ Возможность переноса на SD-карту<br />
<br />
Версия 1.7-43:<br />
+ Добавлена строгая проверка интернета (отлючена по умолчанию)<br />
* Попытка исправить утечку пакетов через мобильную сеть<br />
<br />
Версия 1.7-42:<br />
+ Поддержка MosGorTrans_Free в транспорте<br />
+ Автоматическое добавление версии приложения в тему отчёта<br />
* Отображение версии приложения в кратком логе<br />
* Сборка проекта под Android 7.1 (API 25)</key></branch><branch id=""master""><key id=""version"">0</key><key id=""build"">123</key><key id=""by_build"">1</key><key id=""url"">http://wi-fi.metro-it.com/update.php?download=master</key><key id=""message"">Сборка #123 (26.11.16 20:11:54) ветки master. Об изменениях вы можете узнать из репозитория GitHub (ссылка в настройках приложения).</key></branch><branch id=""experimental""><key id=""version"">0</key><key id=""build"">62</key><key id=""by_build"">1</key><key id=""url"">http://wi-fi.metro-it.com/update.php?download=experimental</key><key id=""message"">Сборка #62 (26.11.16 20:11:22) ветки experimental. Об изменениях вы можете узнать из репозитория GitHub (ссылка в настройках приложения).</key></branch>
```"
mosmetro-android/mosmetro-android,closed,Настройка веток обновления неактивна при доступном интернете,"[Label(name=""bug"")]","Похоже, кэш в CachedRetriever иногда повреждается, в результате чего кнопка выбора ветки обновления остаётся неактивной до потери актуальности кэша. В таком случае помогает либо ожидание, либо сброс всех данных приложения любым доступным способом.

План действий:
* [x] Распространять стандартный список веток вместе с приложением (требует #73)
* [x] Сбрасывать выбранную ветку на master, если она удалена с сервера"
mosmetro-android/mosmetro-android,closed,"Переключение между MosMetro_Free, AURA и MT_Free","[Label(name=""enhancement"")]","Если одна из сетей не работает, то другая ещё может работать. Можно автоматически переключаться между этими сетями в метро, если они обе настроены на устройстве (чтобы не менять настройки Wi-Fi)."
mosmetro-android/mosmetro-android,open,Отдельное отключение поддержки некоторых сетей,"[Label(name=""enhancement"")]","Насколько нам известно, в метро и на наземном транспорте используется разное оборудование. Поэтому можно попробовать реализовать отсеивание сетей по полю OUI из MAC-адреса точки доступа.

* [ ] Собрать список вендоров (OUI)
  * [ ] Добавить разделение на подземные и наземные сети
  * [ ] Разделить наземные сети (какие возможно)
* [ ] Реализовать управление сохранёнными сетями Wi-Fi
  * [ ] Разобраться со сканированием сетей в Android
  * [ ] Android подключается к запрещённой сети - удалить (отключить?) сеть
  * [ ] В радиусе действия находится сеть с разрешённым MAC - добавить (включить?) сеть
    * Включать сеть только если она была отключена ранее или всегда?
* [ ] Предоставить пользователю возможность выбирать, какие сети необходимо игнорировать

## ... или ...

* [ ] Повторить то, что делает приложение MT Cabinet"
mosmetro-android/mosmetro-android,closed,Обработка каптчи для MosMetro v2,"[Label(name=""algorithm"")]","Сразу после последнего обновления алгоритма MosMetro v2 #68 было замечено, что сеть как-то начала определять наличие автоматизаторов и теперь заставляет вводить каптчу.

Варианты решения:
* Обойти детектирование путём маскировки под браузер;
* Выводить каптчу в диалоговом окне в обход браузера;

![Авторизация](https://cloud.githubusercontent.com/assets/6968908/20528491/7041d00c-b0dd-11e6-9a0f-4c0ad784cf7c.jpg)

```html
<!-- код страницы авторизации -->
<html>
<head>
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport"">
  <link rel=""stylesheet"" media=""screen"" href=""/assets/auth/application-e3916cabeea27bc11432f3c5ba9c3bf453b8a36ea296aa5ba7d85b90221b32f4.css"">
</head>
<body>
  <div class=""branding-header"" style=""z-index: 5 !important"">
   <a class=""header-item"" href=""http://login.wi-fi.ru/docs/offers/offer_auth.pdf"">
    <div class=""branding-header__offer"">
     Нажимая кнопку «Войти в Интернет», вы принимаете условия оферты
    </div></a>
   <a class=""header-item"" href=""http://login.wi-fi.ru/vmetro/faq?lang=ru&amp;client_mac="">
    <div class=""branding-header__support"">
     Поддержка
    </div></a>
   <a class=""header-item"" href=""/auto_auth"">
    <div class=""branding-header__lang english"">
     English
    </div></a>
  </div>
  <div class=""auto-auth-view"">
   <div class=""content"">
    <div class=""message"">
     Уважаемый пользователь.
     <br>Возможно, на Вашем устройстве установлено программное обеспечение, производящее автоматическую авторизацию, что противоречит «Условиям пользования Услугами». Для доступа к сети Интернет Вам необходимо удалить данную программу или внести корректировки в настройки браузера. Для автоматического подключения и доступа к сети Интернет без просмотра рекламы Вы можете подключить Услугу&nbsp;
     <a href=""//login.wi-fi.ru/am/UI/Login?org=mac&amp;service=seamless&amp;goto=https://pay.wi-fi.ru"">«Как&nbsp;дома»</a>.
    </div>
   </div>
   <form class=""captcha__container"" action=""/auto_auth"" accept-charset=""UTF-8"" method=""post"">
    <input name=""utf8"" type=""hidden"" value=""✓"">
    <input type=""hidden"" name=""authenticity_token"" value=""er+y2sW/RmP2IJARGSWz6bgzjLAZm+vA+4yConIQ1VTyYi3fptevz6Vkj4tt5TJ4WnRz1LqhWsaW8nblpi90ZQ=="">
    <img class=""captcha__image"" alt=""Captcha"" src=""/rucaptcha/"">
    <div class=""captcha__controls"">
     <input class=""captcha__input form-control"" placeholder=""Введите текст с картинки"" name=""_rucaptcha"" type=""text"" autocorrect=""off"" autocapitalize=""off"" pattern=""[0-9a-z]*"" maxlength=""4"" autocomplete=""off"">
     <input type=""submit"" name=""commit"" value=""OK"" class=""captcha__submit"" data-disable-with=""OK"">
    </div>
   </form>
  </div>
</body>
</html>
```"
mosmetro-android/mosmetro-android,closed,"Изменение алгоритма MosMetro v2 (18.11.16, вечер)","[Label(name=""bug"")]","Похоже, опять что-то поменяли во втором алгоритме. Примерно это же происходило и с первым алгоритмом, когда его только включили. Лог не даёт полезной информации, а только показывает последствия какой-то ошибки.

План действий:
* [x] Собрать лог подключения
* [x] Собрать дамп подключения
* [x] Исправить алгоритм
* [x] Протестировать приложение"
mosmetro-android/mosmetro-android,closed,Перенос приложения на SD-карту,"[Label(name=""enhancement"")]","Несмотря на очень небольшой объем приложения, на некоторых устройствах даже эти 1.5 МБ бывает целесообразнее отдать более важным приложениям, которые не поддерживают перенос на SD-карту. Если никаких проблем из-за этого не возникнет, то почему бы и нет?"
mosmetro-android/mosmetro-android,closed,Опциональная дополнительная проверка соединения,"[Label(name=""enhancement"")]","Встроенная в класс MosMetro проверка у некоторых пользователей не может однозначно определить наличие соединения с интернетом. Перед тем, как говорить о том, что соединение есть, можно дополнительно попробовать соединиться с удалённым сервером. Этот метод дополнительно замедлит подключение, поэтому он должен включаться в настройках приложения.

Например, можно воспользоваться специальным адресом, с помощью которого Android проверяет наличие Captive Portal: http://google.com/generate_204

```
curl -v http://google.com/generate_204
*   Trying 173.194.32.142...
* Connected to google.com (173.194.32.142) port 80 (#0)
> GET /generate_204 HTTP/1.1
> Host: google.com
> User-Agent: curl/7.50.1
> Accept: */*
> 
< HTTP/1.1 204 No Content
< Content-Length: 0
< Date: Fri, 11 Nov 2016 12:12:10 GMT
< 
* Connection #0 to host google.com left intact
```"
mosmetro-android/mosmetro-android,closed,Уведомление остаётся при отключении от сети,"[Label(name=""bug"")]","После добавления поддержки MosGorTrans_Free я заметил, что всегда в одном и том же месте, где я выхожу из трамвая, фоновый сервис не завершается, либо завершается неправильно. Также некоторые пользователи сообщают о подобном поведении в метро.

Если запустить ручное подключение при зависшем уведомлении, приложение видит, что SSID ""подключённой"" сети отображается как ""0x"". Непонятно, почему фоновый сервис на это не реагирует.

Возможно, стоит ввести однозначные критерии состояния Wi-Fi и вынести их в отдельный класс."
mosmetro-android/mosmetro-android,closed,Ошибка при отправке большого лога,"[Label(name=""bug"")]","Из-за огромных HTML страниц лог постепенно перестает влезать в интерфейс Parcellable, что вызывает ошибку при попытке открыть уведомление с таким логом. Сопутствующая проблема: многие почтовые клиенты портят лог, обрабатывая HTML код и ломая переносы строк.

Возможное решение: записывать лог в файл, а в уведомлении хранить путь до этого файла. Тогда при нажатии на уведомление DebugActivity подгружает лог из файла и позволяет отправить данный лог во вложении.
"
mosmetro-android/mosmetro-android,closed,Рефакторинг ConnectionService,"[Label(name=""enhancement"")]","В ветке experimental был начат рефакторинг фонового процесса. Изменения обширные, поэтому потребуется их тщательное тестирование.

Основные задачи:
- [x] Вынести AsyncTask из DebugActivity в отдельный Service (AuthService)
- [x] Переделать ConnectionService из IntentService в обычный Service
- [x] Разбить ConnectionService на несколько задач, которые могут запускаться в любом порядке
- [x] Слежение за Wi-Fi в отдельном потоке (WiFiMonitorTask): остановка сервиса при отключении
- [x] Слежение за соединением с интернетом (NetMonitorTask): перезапуск подключения при ошибке
- [x] Моментальное завершение сервиса при смахивании любого уведомления
- [x] Запуск с ярлыка: пропуск этапа с ожиданием IP
- [x] Использование AuthService как части ConnectionService (binding)

Проблемы:
- [ ] [Одновременная работа ConnectionService и DebugActivity невозможна](https://github.com/TheDrHax/mosmetro-android/issues/63#issuecomment-249699382)
- [ ] [Отключение от Wi-Fi не всегда определяется в WiFiMonitorTask](https://github.com/TheDrHax/mosmetro-android/issues/63#issuecomment-249700818)
- [x] [Переподключение к Wi-Fi глючит при нахождении в двух сетях](https://github.com/TheDrHax/mosmetro-android/issues/63#issuecomment-250736636)
- [ ] Не пытаться бесконечно подключаться к сбойной точке доступа (запоминать последний MAC)
"
mosmetro-android/mosmetro-android,closed,Поддержка сети MosGorTrans_Free,"[Label(name=""enhancement"")]","Сеть MosGorTrans_Free, используемая в наземном транспорте Москвы, обслуживается двумя провайдерами: NetByNet (в транспорте) и Enforta (на остановках).

Вся разработка производится в ветке mosgortrans, которая в одностороннем порядке периодически синхронизируется с веткой master.

План действий:
- [x] Различие сетей на программном уровне: в методе MosGorTrans.isConnected()
  - NetByNet: начальная страница содержит ""mosgortrans.netbynet.ru"" + простое перенаправление
  - Enforta: начальная страница содержит ""enforta.ru"" + meta-перенаправление
- [ ] Реализовать поддержку сетей
  - [x] Поддержка NetByNet
  - [ ] Поддержка Enforta
- [x] Привести класс MosGorTrans в порядок и проверить его на стабильность (переписан с нуля)
- [x] Включить поддержку MosGorTrans_Free в ветку master
## NetByNet
- [x] Добыть дамп подключения
- [x] Реализовать алгоритм: метод MosGorTrans.connect_netbynet()
- [x] Протестировать алгоритм в наземном транспорте
- [x] Добавить поддержку сети в основную ветку
## Enforta
- [x] Добыть дамп подключения
- [ ] Реализовать алгоритм: метод MosGorTrans.connect_enforta()
  - [x] Реализовать генерацию пары логин-пароль для Enforta
    - [x] Вытащить данные для генерации с enforta.ru/login
      - Логин: ""username\.value = \""(.*?)\"";""
      - Выражение для пароля: ""username\.value = \""(.*?)\"";""
    - [x] Расчитать MD5 хэш из выражения для пароля: Использована библиотека Mozilla Rhino и [скрипт](http://hs.enforta.ru/js/devices/routeros-md5.js) с сайта Enforta. Значение MD5, полученное из стандартной библиотеки, не сходится с тем, что получается из JavaScript.
    - [x] Подставить полученные данные в форму авторизации
  - [ ] Легкие HTTP-клиенты, типа OkHttp или JSoup, несовместимы с Enforta
    - [x] OkHttp: Ошибка `java.io.IOException: unexpected end of stream on okhttp3.Address@19866665`. Решается добавлением заголовка ""Connection: close"", приводя к поведению, аналогичному Jsoup.
    - [x] Jsoup: Поведение отличается от браузера. При сравнении дампов оказывается, что в месте ошибки (см. [лог](https://github.com/TheDrHax/mosmetro-android/issues/62#issuecomment-248354778)) происходит отправка лишнего запроса, который никак нельзя заблокировать.
      - [x] [Собрать дамп для примера](https://github.com/TheDrHax/mosmetro-android/issues/62#issuecomment-248669143)
    - [x] Apache HttpComponents (deprecated on API > 23)
    - [x] HttpURLConnection ([http-request](http://kevinsawicki.github.io/http-request/)) — аналогично Jsoup
    - [ ] ...
- [ ] Протестировать алгоритм на остановках
- [ ] Добавить поддержку сети в основную ветку
"
mosmetro-android/mosmetro-android,closed,Английская локализация,"[Label(name=""enhancement"")]","После закрытия тикета #48 появилась возможность перевести приложение на другие языки путём создания альтернативных файлов strings.xml. Думаю, английская версия никому не помешает.

![2016-09-14 11-57-37](https://cloud.githubusercontent.com/assets/6968908/18506019/a9bd74a4-7a72-11e6-820b-662f35ab285a.png)
"
mosmetro-android/mosmetro-android,closed,Поддержка сети на МЦК,"[Label(name=""enhancement"")]","На недавно открывшемся кольце тоже есть сеть Wi-Fi. Судя по присланным логам, сеть имеет то же название MosMetro_Free, однако алгоритм подключения там другой.

План действий:
- [x] Добыть лог подключения
- [x] Добыть дамп подключения
- [x] Сравнить алгоритмы в метро и на МЦК
- [x] Адаптировать существующий алгоритм для двух сетей (https://github.com/TheDrHax/mosmetro-android/commit/5172cecb5067c4c1ffecd59ce5f8d9edbee30c91)
- [x] Протестировать работу алгоритма
"
mosmetro-android/mosmetro-android,closed,При добавлении нового события в лог подключения оно прокручивается на начало.,"[Label(name=""bug"")]","Версия 1.6.2-37 - в логе подключения при каждом новом добавлении события, прокрутка улетает в начало, а не в конец, как это было сделано раньше. Смотреть что происходит очень неудобно.
В версии 1.6.1-34 работает как надо
"
mosmetro-android/mosmetro-android,open,Не работает автоматическое (фоновое) подключение,"[Label(name=""external bug"")]","Device: Xiaomi Redmi note 3 pro
Android: 5.5.1
MIUI:  7.5.4.0

Для приложения открыты все требуемые разрешения. Энергосберегающий режим отключен. Программа просто ничего не делает при подключении к wifi, если ее не запустить вручную. 

Так же у программы не получается переподключить wifi, если есть проблемы с подключением. Она просто останавливается на этом моменте. 
"
mosmetro-android/mosmetro-android,closed,Добавить версию приложения в тему отчета об ошибке,"[Label(name=""enhancement"")]","Нужно сделать темы писем с отчетами об ошибках более полезными, добавив в них информацию о версии приложения примерно в таком формате: ""Отчет об ошибке v1.6.1-34"".
"
mosmetro-android/mosmetro-android,closed,[1.6.2-35] Приложение останавливается на поиске алгоритма,"[Label(name=""bug"")]","По сообщениям бета-тестировщиков, приложение не может выбрать алгоритм при подключении к сети даже несмотря на правильный SSID. В некоторых случаях выдается сообщение о том, что алгоритм не найден, однако в большинстве случаев поиск просто останавливается.

> 13 июля 2016 г. 8:34:51 AM
> Поиск подходящего алгоритма для сети MosMetro_Free
"
mosmetro-android/mosmetro-android,closed,[MosMetro] Перенаправление получается два раза подряд,"[Label(name=""enhancement"")]","В классе MosMetro для подключения необходимо получить перенаправление на страницу авторизации. Сначала перенаправление получается в функции `isConnected()`, но оно используется только для определения состояния сети и затем игнорируется. Далее это же перенаправление получается в функции `connect()` уже после проверки соединения с интернетом. Такой подход во-первых неэффективен, а во-вторых может выдать тот факт, что устройство использует автоматизацию подключения.

Спасибо @Revertron за наводку на эту проблему.
"
mosmetro-android/mosmetro-android,closed,Регистрация NetworkReceiver при загрузке системы,"[Label(name=""enhancement"")]","На некоторых устройствах NetworkReceiver не регистрируется автоматически при загрузке Android, поэтому нужно добавить ещё один Reciever в автозагрузку, чтобы он регистрировал NetworkReceiver.
"
mosmetro-android/mosmetro-android,closed,Сеть отключена. Повторите вход.,"[Label(name=""question"")]","Здравствуйте, уважаемые разработчики. На моем Galaxy S5 возникает проблема: Включаешь Wi-Fi,  телефон сам находит сеть, подключается и вылетает с ошибкой ""Сеть отключена..."". Приходится принудительно заходить в настройки Wi-Fi,  принудительно подключаться, открывается браузер параллельно приложению, после чего у приложения остается всего 1 попытка из 3. Можно ли как-то поставить приложение в приоритет при подключении, вместо браузера (в качестве redirect-а)?  
В приложении, при этом, написано:
Ошибка: сеть недоступна или не отвечает. 
Перезапуск Wi-Fi. ..
И все, можно ждать до бесконечности.

P.S. Заранее прошу прощения, если этот вопрос не в Вашей компетенции.
"
mosmetro-android/mosmetro-android,closed,Получение названия сети из Intent,"[Label(name=""enhancement"")]","В составе Intent android.net.wifi.STATE_CHANGE обычно возвращаются несколько полей, содержащих информацию о подключенной сети. Возможно, это позволит избежать получение некорректного названия сети (issue #41).

Этот тикет отделился от issue #47.
"
mosmetro-android/mosmetro-android,closed,При недоступности сайта wi-fi.ru алгоритм работает некорректно,"[Label(name=""bug"")]","Сегодня столкнулся с тем, что сайты wi-fi.ru и vmet.ro оказались недоступны, однако интернет при этом работал нормально. Следуя алгоритму подключения, это привело к постоянному выводу сообщения об ошибке ""Сеть недоступна или не отвечает"". Стоит сделать еще более устойчивую проверку в классе MosMetro.
"
mosmetro-android/mosmetro-android,closed,Не подключается с первого (и даже с третьего) раза,"[Label(name=""bug"")]","В последнее время стала очень выражена проблема, когда приложение тратит все попытки подключения, однако каждый раз доступ в интернет не появляется.

Нормальное подключение должно занимать 1-2 попытки из 3 (по умолчанию), однако на данный момент не всегда хватает даже 5 попыток.

Типичное проявление этой проблемы: в конце каждой попытки появляется ошибка ""доступ в интернет отсутствует"", т.е. сеть продолжает перенаправлять устройство на авторизацию.

Стоит заметить, что подключение через браузер всегда срабатывает с первого раза. Точно так же может сработать и ручное подключение, если запустить его где-то через минуту после получения IP (не точно).

Предположительные причины проблемы:
- в сеть добавили ограничение скорости подключения для отсеивания скриптов авторизации: приложение отсылает запрос сразу после получения IP;
- некритично поменялся алгоритм подключения: стоит сравнить дамп подключения через браузер с тем, что в коде.
"
mosmetro-android/mosmetro-android,closed,Не говорить «уже подключено» при мобильном интернете,[],"А то он в тоннеле плохо ловит, а эта программа не начинает подключаться к MosMetro_Free
"
mosmetro-android/mosmetro-android,closed,Вынести строки из кода в strings.xml для возможности локализации,"[Label(name=""enhancement"")]","Лучше вынести строки в strings.xml, чтобы можно было предоставить желающим возможность перевода программы. Да и сейчас текст в коде считается моветоном.
Эта задача не так страшна, тем более, что IDEA предоставляет для этого отличную автоматизацию.
"
mosmetro-android/mosmetro-android,closed,Повторение отправки некоторых запросов вместо перезапуска всего алгоритма,"[Label(name=""enhancement"")]","Вместо обработки android.net.wifi.STATE_CHANGE лучше ловить android.net.wifi.WIFI_STATE_CHANGED (WifiManager.WIFI_STATE_CHANGED_ACTION).

Дело в том, что сейчас Receiver получает событие задолго до реального подключения, и приходится гадать (кто на чём может) для установки правильной задержки перед получением IP.
Но задержка не нужна при получении android.net.wifi.WIFI_STATE_CHANGED. Там нужно только проверить, что сеть действительно подключилась, а не сделала что-то другое и всё.

Сейчас посмотрю код, может PR запилю.
"
mosmetro-android/mosmetro-android,closed,"Фоновый процесс выпадает с ошибкой, если отключить Wi-Fi",[],"Если после успешного подключения к сети отключить Wi-Fi, фоновый процесс может выпасть с ошибкой, о чем система покажет предупреждение.
"
mosmetro-android/mosmetro-android,closed,Создание ярлыка ручного подключения из настроек,"[Label(name=""enhancement"")]","Не все лаунчеры поддерживают создание ярлыков ручного подключения через меню виджетов. Для таких случаев будет полезно добавить пункт создания такого ярлыка прямо в настройки приложения.
"
mosmetro-android/mosmetro-android,closed,"Ожидание IP адреса зависает, если отключить Wi-Fi","[Label(name=""bug"")]","Нужно добавить проверку статуса Wi-Fi в метод проверки сети в ConnectionService. В некоторых случаях ожидание IP адреса зависает до тайм-аута, которого нет в старых версиях.
"
mosmetro-android/mosmetro-android,closed,Ветки обновления могут не загрузиться,"[Label(name=""bug"")]","В некоторых случаях приложение не может нормально загрузить ветки обновления и их список остается пустым.

![image](https://cloud.githubusercontent.com/assets/6968908/14770074/27305a54-0a71-11e6-984d-6345e16d910b.png)

Нужно воспользоваться одним из решений:
- сделать постоянные ветки, которые будут всегда в списке (play, beta, master)
- не делать пункт выбора ветки активным до тех пор, пока нормальный список не будет загружен

Второй вариант предпочтительнее, так как в первом случае ветки хоть и будут в списке, но информации о них не будет. Это бессмысленно с точки зрения обновления, однако позволяет поменять ветку на будущее.
"
mosmetro-android/mosmetro-android,closed,Проблема с предупреждением о регистрации,"[Label(name=""bug"")]","Если устройство не зарегистрировано в сети, появляется уведомление об этом, но через несколько секунд приложение снова пытается подключиться, из-за чего удаляет уведомление о регистрации.
"
mosmetro-android/mosmetro-android,closed,Android возвращает некорректное название сети,"[Label(name=""external bug"")]","В некоторых случаях приложение не может определить корректное название сети Wi-Fi, чтобы подобрать правильный алгоритм.

Вот пример лога, появившегося при подключении к сети MosMetro_Free:

```
> 15 апр 2016 г. 1:17:59 PM
>> Определение названия сети
>> Поиск подходящего алгоритма для сети ""orBfQcNFF06CIzo""
<< Ошибка: Вы не подключены ни к одной из поддерживаемых сетей
```
"
mosmetro-android/mosmetro-android,closed,Проблема с блокировщиками рекламы,"[Label(name=""bug"")]","Стало известно, что некоторые блокировщики рекламы (например AdGuard) блокируют некоторые проверки в приложении. Это приводит к тому, что приложение всегда думает, что ""Сеть недоступна или не отвечает"". Дело в том, что в списках блокировки присутствуют сайты example.com и vmet.ro, которые используются приложением. При внесении этих адресов в исключения, проблема пропадает. Думаю, достаточно будет не использовать эти сайты в алгоритме.

Пример лога с такой проблемой:

```
>> Проверка доступа в интернет
java.lang.Exception: Empty response
at pw.thedrhax.mosmetro.httpclient.clients.OkHttp.parseDocument(OkHttp.java:97)
at pw.thedrhax.mosmetro.httpclient.clients.OkHttp.get(OkHttp.java:66)
at pw.thedrhax.mosmetro.authenticator.networks.MosMetro.isConnected(MosMetro.java:130)
at pw.thedrhax.mosmetro.authenticator.networks.MosMetro.connect(MosMetro.java:33)
at pw.thedrhax.mosmetro.authenticator.Authenticator.start(Authenticator.java:86)
at pw.thedrhax.mosmetro.services.ConnectionService.connect(ConnectionService.java:193)
at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent(ConnectionService.java:232)
at android.app.IntentService$ServiceHandler.handleMessage(IntentService.java:65)
at android.os.Handler.dispatchMessage(Handler.java:102)
at android.os.Looper.loop(Looper.java:135)
at android.os.HandlerThread.run(HandlerThread.java:61)

<< Ошибка: Сеть недоступна или не отвечает
```
"
mosmetro-android/mosmetro-android,closed,Автоматическое отключение/подключение сети при ошибке,"[Label(name=""enhancement"")]","В последнее время довольно часто стала появляться ошибка ""Сеть недоступна или не отвечает"", которая решается перезапуском Wi-Fi. Было бы полезно автоматически переподключать сеть в случае этой ошибки. По аналогии с функцией ""Переподключение к Wi-Fi"" нужно сделать эту функцию отключенной по-умолчанию.
"
mosmetro-android/mosmetro-android,closed,Длительная задержка с белым экраном в ручном подключении,"[Label(name=""bug"")]","При нестабильном соединении с сетью ручное подключение может довольно долго запускаться. При этом на экране не отображается никаких сообщений.
"
mosmetro-android/mosmetro-android,closed,Динамическая подгрузка веток обновления,"[Label(name=""enhancement"")]",
mosmetro-android/mosmetro-android,closed,Сеть AURA ,"[Label(name=""question"")]","В метро появилась новая сеть. Что это именно - не знаю, но работает на частоте 5 ггц и выдает тот же captive портал c той же метрошной авторизацией.
Но никаких официальных новостей не было. 
Может стоит добавить в список SSIDов?
"
mosmetro-android/mosmetro-android,closed,Ветка mosgortrans: Проблема при переходе между сетями,"[Label(name=""bug"")]","При переходе между поддерживаемыми сетями приложение не замечает этого и не подключается. Нужно хранить SSID подключенной сети в ConnectionService.
"
mosmetro-android/mosmetro-android,closed,Код 301 на странице авторизации,[],"Уже не первый раз приходит лог, в котором вместо страницы авторизации возвращается перенаправление с кодом 301. Не знаю, куда оно ведет, но, скорее всего, на HTTPS версию сайта. Приложение по умолчанию не следует перенаправлениям, но именно на этом этапе это стоит предусмотреть.

```
>>> Получение страницы авторизации
<html>
<head>
  <title>301 Moved Permanently</title>
</head> 
<body bgcolor=""white""> 
  <center>
   <h1>301 Moved Permanently</h1>
  </center> 
  <hr>
  <center>
   nginx
  </center>   
</body>
</html>
<<< Ошибка: форма авторизации не найдена
```
"
mosmetro-android/mosmetro-android,closed,Виджет (ярлык) для фонового подключения,"[Label(name=""enhancement"")]","Нужно сделать возможность запускать с ярлыка не только ручное подключение с логом, но и фоновый сервис, который просто покажет уведомление.
"
mosmetro-android/mosmetro-android,closed,Очередной отчет из Google Play,"[Label(name=""bug"")]","```
java.lang.RuntimeException: An error occured while executing doInBackground()
    at android.os.AsyncTask$3.done(AsyncTask.java:300)
    at java.util.concurrent.FutureTask.finishCompletion(FutureTask.java:355)
    at java.util.concurrent.FutureTask.setException(FutureTask.java:222)
    at java.util.concurrent.FutureTask.run(FutureTask.java:242)
    at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
    at java.lang.Thread.run(Thread.java:841)
Caused by: java.lang.NumberFormatException: Invalid int: """"
    at java.lang.Integer.invalidInt(Integer.java:137)
    at java.lang.Integer.parseInt(Integer.java:358)
    at java.lang.Integer.parseInt(Integer.java:331)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask$Branch.<init>(UpdateCheckTask.java:139)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask.doInBackground(UpdateCheckTask.java:64)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask.doInBackground(UpdateCheckTask.java:19)
    at android.os.AsyncTask$2.call(AsyncTask.java:288)
    at java.util.concurrent.FutureTask.run(FutureTask.java:237)
    ... 4 more
```
"
mosmetro-android/mosmetro-android,closed,URL перенаправления изменился,[],"Похоже, убрали протокол из начала URL перенаправления, находящегося в meta теге. Пора бы сделать что-нибудь универсальное.

Лог подключения:

```
> 18 марта 2016 г. 8:44:41
Версия приложения: 1.5-28
>> Проверка доступа в интернет
<< Все проверки пройдены
>> Подключаюсь...
>>> Получение начального перенаправления
<html>
<head>
<title> Web Authentication Redirect</title>
<meta http-equiv=""Cache-control"" content=""no-cache"">
<meta http-equiv=""Pragma"" content=""no-cache"">
<meta http-equiv=""Expires"" content=""-1"">
<meta http-equiv=""refresh"" content=""1; 
URL=login.vmet.ro/am/UI/Login&amp;ap_mac=5c:a4:8a:1e:4c:20&amp;client_mac=68:3e:34:1e:7d:db&amp;wlan=MosMetro_Free&amp;redirect=vmet.ro/"">
</head>
<body>
</body>
</html>
login.vmet.ro/am/UI/Login&ap_mac=5c:a4:8a:1e:4c:20&client_mac=68:3e:34:1e:7d:db&wlan=MosMetro_Free&redirect=vmet.ro/
>>> Получение страницы авторизации
<html>
<head>
<title>301 Moved Permanently</title>
</head>
<body bgcolor=""white"">
<center>
<h1>301 Moved Permanently</h1>
</center>
<hr>
<center>
nginx
</center>
</body>
</html>
<<< Ошибка: форма авторизации не найдена
< 18 марта 2016 г. 8:44:42
```
"
mosmetro-android/mosmetro-android,closed,Строгое определение сети себя не оправдало?,"[Label(name=""bug"")]","Похоже, что более строгая проверка сети Wi-Fi, добавленная в ab616ba91f7cfa93edcb03349d46da04bdd39a6b (issue #19) привела к тому, что на некоторых устройствах проверка стала всегда срабатывать отрицательно. Если же ее отключить, то на других устройствах проверка срабатывает положительно не на те сети.

Это уже не первое добавление/удаление этой проверки, так что, думаю, нужно сделать настройку, которая **отключена** по умолчанию и **включает** строгую проверку. Если у кого-то приложение срабатывает не на те сети, он сможет включить более строгую проверку, которая это исправит.
"
mosmetro-android/mosmetro-android,closed,Проблемы с Mi Phone,"[Label(name=""bug"")]","От нескольких пользователей поступило сообщение о неработающем подключении. Проблемы объединяются подписью ""Отправлено с Mi Phone"" и отсутствием переносов строк в логе.

Вот участок лога (переносы строк добавлены):

```
> 17 марта 2016 г. 16:53:58
>> Ожидание получения IP адреса...
<< IP адрес получен в течение 0 секунд
Версия приложения: 1.5-28
>> Проверка доступа в интернет
<< Ошибка: Сеть недоступна или не отвечает 
```

Пока что информации недостаточно для того, чтобы точно определить причину этой ошибки. Известно только то, что подключение через браузер при этом работает.

Нужно добавить проверку подключения в отладочный лог, чтобы узнать об этой проблеме больше.
"
mosmetro-android/mosmetro-android,closed,"Возможно, готовится изменение алгоритма",[],"Снова поступило сообщение об ошибке, в котором фигурирует адрес authrad.vmet.ro. Сам я с таким не сталкивался, но такая проблема упоминалась в #15.

```
>>> Получение начального перенаправления
<html>
<head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://authrad.vmet.ro/?switch_url=http://1.1.1.1/login.html&amp;ap_mac=5c:a4:8a:93:e8:b0&amp;client_mac=00:0a:f5:89:e2:58&amp;wlan=MosMetro_Free&amp;redirect=vmet.ro/"">
</head>
<body> 
</body>
</html>
http://authrad.vmet.ro/?switch_url=http://1.1.1.1/login.html&ap_mac=5c:a4:8a:93:e8:b0&client_mac=00:0a:f5:89:e2:58&wlan=MosMetro_Free&redirect=vmet.ro/
>>> Получение страницы авторизации
java.net.ConnectException: Failed to connect to authrad.vmet.ro/10.1.1.5:80
at okhttp3.internal.io.RealConnection.connectSocket(RealConnection.java:142)
at okhttp3.internal.io.RealConnection.connect(RealConnection.java:111)
at okhttp3.internal.http.StreamAllocation.findConnection(StreamAllocation.java:188)
at okhttp3.internal.http.StreamAllocation.findHealthyConnection(StreamAllocation.java:127)
at okhttp3.internal.http.StreamAllocation.newStream(StreamAllocation.java:97)
at okhttp3.internal.http.HttpEngine.connect(HttpEngine.java:289)
at okhttp3.internal.http.HttpEngine.sendRequest(HttpEngine.java:241)
at okhttp3.RealCall.getResponse(RealCall.java:240)
at okhttp3.RealCall$ApplicationInterceptorChain.proceed(RealCall.java:198)
at okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:160)
at okhttp3.RealCall.execute(RealCall.java:57)
at pw.thedrhax.mosmetro.authenticator.Authenticator.getPageContent(Authenticator.java:116)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:205)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:34)
at pw.thedrhax.mosmetro.services.ConnectionService.connect(ConnectionService.java:199)
at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent(ConnectionService.java:229)
at android.app.IntentService$ServiceHandler.handleMessage(IntentService.java:65)
at android.os.Handler.dispatchMessage(Handler.java:102)
at android.os.Looper.loop(Looper.java:136)
at android.os.HandlerThread.run(HandlerThread.java:61)

<<< Ошибка: страница авторизации не получена
```
"
mosmetro-android/mosmetro-android,closed,Кэширование base_url не работает,"[Label(name=""bug"")]","Приложение запрашивает base_url каждый раз при обращении к классу BaseUrlRetriever, однако оно должно делать это максимум раз в час. Как минимум, это происходит при ручной проверке обновлений из главного меню.
"
mosmetro-android/mosmetro-android,closed,Больше кэширования,"[Label(name=""enhancement"")]","Необходимо реализовать кэширование для проверки обновлений и DNS. Можно использовать уже существующую реализацию BaseUrlRetriever, только нужно сделать её более универсальной.
"
mosmetro-android/mosmetro-android,closed,Поддержка сети MosGorTrans_Free,"[Label(name=""enhancement"")]","Было бы неплохо сделать приложение менее специализированным и обратить внимание на другие сети, требующие прохождение авторизации.
"
mosmetro-android/mosmetro-android,closed,Проверка доступа в интернет в фоновом процессе,"[Label(name=""enhancement"")]","Нужно периодически проверять соединение с интернетом (с помощью Authenticator.isConnected()), чтобы приложение не упускало момент сброса авторизации. Это можно сделать в ConnectionService, в котором есть ""вечный"" цикл, проверяющий подключение к Wi-Fi.
"
mosmetro-android/mosmetro-android,closed,Отмена проверки обновлений при закрытии окна настроек,"[Label(name=""enhancement"")]","Нужно завершать фоновый процесс проверки обновлений, если SettingsActivity закрывается до вывода уведомления.
"
mosmetro-android/mosmetro-android,closed,"""4 попытка из 3""","[Label(name=""bug"")]","Попытки подключения в уведомлениях считаются неправильно.
"
mosmetro-android/mosmetro-android,closed,Зависание ConnectionService,"[Label(name=""bug"")]","В некоторых случаях в ConnectionService не приходит сообщение об отвалившейся сети, что приводит к его постоянному ожиданию IP адреса. Нужно переписать сервис, сделав его постоянным, чтобы он был запущен, когда сеть подключена.
"
mosmetro-android/mosmetro-android,closed,Иконки уведомлений плохо читаемы,"[Label(name=""enhancement"")]","На небольших экранах и экранах с низкой плотностью пикселей мелкие значки в центре иконок уведомлений плохо видно. Нужно переделать иконки, чтобы они однозначно сообщали о результате работы, не заставляя всматриваться в них.
"
mosmetro-android/mosmetro-android,closed,Ложные срабатывания,"[Label(name=""bug"")]","Стали поступать сообщения о том, что приложение реагирует не только на сеть MosMetro_Free, но и на другие сети, в том числе иногда запускается при активном мобильном интернете.

Скорее всего, Android возвращает SSID текущей сети не только, когда она подключена.
"
mosmetro-android/mosmetro-android,closed,Очередной отчет из Google Play,"[Label(name=""bug"")]","Android 6.0; Nexus 5; Версия приложения: 21

```
android.view.WindowManager$BadTokenException: Unable to add window -- token android.os.BinderProxy@c166e21 is not valid; is your activity running?
    at android.view.ViewRootImpl.setView(ViewRootImpl.java:567)
    at android.view.WindowManagerGlobal.addView(WindowManagerGlobal.java:310)
    at android.view.WindowManagerImpl.addView(WindowManagerImpl.java:85)
    at android.app.Dialog.show(Dialog.java:319)
    at android.app.AlertDialog$Builder.show(AlertDialog.java:1112)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask.showDialog(UpdateCheckTask.java:108)
    at pw.thedrhax.mosmetro.activities.SettingsActivity$1.result(SettingsActivity.java:49)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask.onPostExecute(UpdateCheckTask.java:78)
    at pw.thedrhax.mosmetro.updater.UpdateCheckTask.onPostExecute(UpdateCheckTask.java:19)
    at android.os.AsyncTask.finish(AsyncTask.java:651)
    at android.os.AsyncTask.-wrap1(AsyncTask.java)
    at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:668)
    at android.os.Handler.dispatchMessage(Handler.java:102)
    at android.os.Looper.loop(Looper.java:148)
    at android.app.ActivityThread.main(ActivityThread.java:5453)
    at java.lang.reflect.Method.invoke(Native Method)
    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:726)
    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:616)
```
"
mosmetro-android/mosmetro-android,closed,Проверка состояния сети,"[Label(name=""enhancement"")]","В моменты высокой нагрузки на сеть DHCP может долго не выдавать IP. Приложение тратит все попытки подключения в никуда, а после полного подключения к Wi-Fi больше не пытается соединиться.
"
mosmetro-android/mosmetro-android,closed,Приложение отправляет запросы через мобильную сеть в обход Wi-Fi,"[Label(name=""bug"")]","В случае, если мобильный интернет доступен в момент подключения к Wi-Fi, запросы от приложения уходят в обход сети Wi-Fi. Нужно найти способ этого избежать (желательно, не отключая мобильный интернет).
"
mosmetro-android/mosmetro-android,closed,"Возможно, алгоритм снова обновляется","[Label(name=""bug"")]","Получил такой лог:

```
Версия приложения: 1.4-20
> 24 Фев 2016 г. 21:00:44
>> Проверка доступа в интернет
java.io.EOFException
at com.android.okhttp.internal.Util.readAsciiLine(Util.java:318)
at com.android.okhttp.internal.http.RawHeaders.fromBytes(RawHeaders.java:308)
at com.android.okhttp.internal.http.HttpTransport.readResponseHeaders(HttpTransport.java:147)
at com.android.okhttp.internal.http.HttpEngine.readResponse(HttpEngine.java:795)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:347)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:296)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:503)
at pw.thedrhax.httpclient.HttpRequest.connect(HttpRequest.java:116)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:67)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:89)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.isConnected(AuthenticatorStat.java:49)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:98)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:37)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:124)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:110)
at android.os.AsyncTask$2.call(AsyncTask.java:288)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
at java.lang.Thread.run(Thread.java:841)

<< Все проверки пройдены
>> Подключаюсь...
>>> Получение начального перенаправления
<html>
<head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://authrad.vmet.ro/?switch_url=http://1.1.1.1/login.html&amp;ap_mac=c4:14:3c:7a:70:40&amp;client_mac=48:5a:3f:51:ff:66&amp;wlan=MosMetro_Free&amp;redirect=vmet.ro/"">
</head>
<body> 
</body>
</html>
http://authrad.vmet.ro/?switch_url=http://1.1.1.1/login.html&ap_mac=c4:14:3c:7a:70:40&client_mac=48:5a:3f:51:ff:66&wlan=MosMetro_Free&redirect=vmet.ro/
>>> Получение начальной страницы
java.net.ConnectException: failed to connect to authrad.vmet.ro/10.1.1.5 (port 80) after 2000ms: isConnected failed: ECONNREFUSED (Connection refused)
at libcore.io.IoBridge.isConnected(IoBridge.java:223)
at libcore.io.IoBridge.connectErrno(IoBridge.java:161)
at libcore.io.IoBridge.connect(IoBridge.java:112)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:192)
at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:460)
at java.net.Socket.connect(Socket.java:833)
at com.android.okhttp.internal.Platform.connectSocket(Platform.java:152)
at com.android.okhttp.Connection.connect(Connection.java:949)
at com.android.okhttp.internal.http.HttpEngine.connect(HttpEngine.java:405)
at com.android.okhttp.internal.http.HttpEngine.sendSocketRequest(HttpEngine.java:343)
at com.android.okhttp.internal.http.HttpEngine.sendRequest(HttpEngine.java:289)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:345)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:296)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:503)
at pw.thedrhax.httpclient.HttpRequest.connect(HttpRequest.java:116)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:67)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:89)
at pw.thedrhax.mosmetro.authenticator.Authenticator.getPageContent(Authenticator.java:51)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:141)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:37)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:124)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:110)
at android.os.AsyncTask$2.call(AsyncTask.java:288)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
at java.lang.Thread.run(Thread.java:841)
Caused by: libcore.io.ErrnoException: isConnected failed: ECONNREFUSED (Connection refused)
at libcore.io.IoBridge.isConnected(IoBridge.java:208)
... 27 more

<<< Ошибка: начальная страница не получена
```

Authrad.vmet.ro — это что-то новое. Раньше такого не видел.
"
mosmetro-android/mosmetro-android,closed,Обработка первого подключения,"[Label(name=""enhancement"")]","При первом подключении устройства к сети требуется пройти регистрацию с указанием номера телефона и получением кода по СМС. До регистрации устройства приложение не будет работать.

Похоже, что, наконец-то, удалось получить лог с незарегистрированного устройства:

```
>>> Получение страницы авторизации
<!doctype html>
<html>
<head>
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate"">
  <meta name=""robots"" content=""noindex, nofollow""> 
  <title>Авторизация Wi-Fi. Идентификация</title>  
  <meta content=""text/html; charset=UTF-8"" http-equiv=""Content-Type""> 
  <meta charset=""utf-8""> 
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport""> 
  <meta content=""Авторизация Wi-Fi"" name=""description""> 
  <meta content=""АО «МаксимаТелеком»"" name=""author""> 
  <link rel=""icon"" href=""/am/favicon.ico"" type=""image/x-icon""> 
  <link rel=""shortcut icon"" href=""/am/favicon.ico"" type=""image/x-icon""> 
  <link rel=""stylesheet"" media=""all"" href=""/am/static/metro2015/assets/application_v2.css?version=v13.0.0-SNAPSHOT-c23b4"">     
  <link rel=""stylesheet"" media=""all"" href=""/websso/css/mac_otp_phone.css?20160223"">   
</head> 
<body class=""page phone--gossuslugi""> 
  <div id=""root""> 
   <header> 
    <div id=""logo""></div> 
    <div id=""language"">
     <a href=""?rand=YYNBDC3F&amp;org=mac&amp;service=coa&amp;client_mac=50-2e-5c-50-72-3c&amp;ForceAuth=true&amp;lang=en""><span class=""flag-icon flag-icon-uk"">&nbsp;</span>English</a>
    </div> 
   </header> 
   <div class=""row""> 
    <div class=""col"" id=""left-block""> 
     <h1>Способы идентификации</h1> 
    </div> 
    <div class=""col active"" id=""right-block""> 
     <div id=""container-wrapper""> 
      <div id=""top-container""> 
       <div class=""row""> 
        <form action="""" accept-charset=""UTF-8"" method=""post""> 
         <input type=""hidden"" name=""IDToken1""> 
         <input type=""hidden"" name=""IDButton"" value=""esia""> 
         <button type=""submit"" id=""esia-login"" class=""button"">Через портал госуслуг</button> 
         <input type=""hidden"" name=""csrf.sign"" value=""bb772ea142481fbd35c79e102f13dd001bede5a48f46e8a038a50f444902f014"">
         <input type=""hidden"" name=""csrf.ts"" value=""1456240331340"">
        </form> 
       </div> 
      </div> 
      <div id=""right-container"" style=""display: none""> 
       <h2>Отправив СМС</h2> 
       <form id=""sms-form"" class=""parsley"" action="""" accept-charset=""UTF-8"" method=""post""> 
        <input id=""merged-phone"" name=""IDToken1"" type=""hidden""> 
        <div class=""row""> 
         <select name=""country"" id=""country"" class=""custom countries"" style=""width: 78px; padding: 8px 10px"" data-value=""ru""> <option disabled value="""">Часто используемые</option> <option data-code=""+7"" data-min=""10"" data-max=""10"" value=""ru"">RU +7</option> <option data-code=""+380"" data-min=""9"" data-max=""9"" value=""ua"">UA +380</option> <option data-code=""+375"" data-min=""9"" data-max=""9"" value=""by"">BY +375</option> <option data-code=""+7"" data-min=""10"" data-max=""10"" value=""kz"">KZ +7</option> <option data-code=""+992"" data-min=""9"" data-max=""9"" value=""tj"">TJ +992</option> <option disabled value=""""></option> <option disabled value="""">Все страны</option> <option data-code=""+247"" data-min=""4"" data-max=""4"" value=""ac"">AC +247</option> <option data-code=""+376"" data-min=""6"" data-max=""6"" value=""ad"">AD +376</option> <option data-code=""+971"" data-min=""9"" data-max=""9"" value=""ae"">AE +971</option> <option data-code=""+93"" data-min=""9"" data-max=""9"" value=""af"">AF +93</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""ag"">AG +1</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""ai"">AI +1</option> <option data-code=""+355"" data-min=""9"" data-max=""9"" value=""al"">AL +355</option> <option data-code=""+374"" data-min=""8"" data-max=""8"" value=""am"">AM +374</option> <option data-code=""+599"" data-min=""7"" data-max=""7"" value=""an"">AN +599</option> <option data-code=""+244"" data-min=""9"" data-max=""9"" value=""ao"">AO +244</option> <option data-code=""+672"" data-min=""6"" data-max=""6"" value=""aq"">AQ +672</option> <option data-code=""+54"" data-min=""10"" data-max=""10"" value=""ar"">AR +54</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""as"">AS +1</option> <option data-code=""+43"" data-min=""10"" data-max=""10"" value=""at"">AT +43</option> <option data-code=""+61"" data-min=""9"" data-max=""9"" value=""au"">AU +61</option> <option data-code=""+297"" data-min=""7"" data-max=""7"" value=""aw"">AW +297</option> <option data-code=""+994"" data-min=""9"" data-max=""9"" value=""az"">AZ +994</option> <option data-code=""+387"" data-min=""7"" data-max=""7"" value=""ba"">BA +387</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""bb"">BB +1</option> <option data-code=""+880"" data-min=""8"" data-max=""8"" value=""bd"">BD +880</option> <option data-code=""+32"" data-min=""9"" data-max=""9"" value=""be"">BE +32</option> <option data-code=""+226"" data-min=""8"" data-max=""8"" value=""bf"">BF +226</option> <option data-code=""+359"" data-min=""9"" data-max=""9"" value=""bg"">BG +359</option> <option data-code=""+973"" data-min=""8"" data-max=""8"" value=""bh"">BH +973</option> <option data-code=""+257"" data-min=""8"" data-max=""8"" value=""bi"">BI +257</option> <option data-code=""+229"" data-min=""8"" data-max=""8"" value=""bj"">BJ +229</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""bm"">BM +1</option> <option data-code=""+673"" data-min=""7"" data-max=""7"" value=""bn"">BN +673</option> <option data-code=""+591"" data-min=""8"" data-max=""8"" value=""bo"">BO +591</option> <option data-code=""+55"" data-min=""10"" data-max=""11"" value=""br"">BR +55</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""bs"">BS +1</option> <option data-code=""+975"" data-min=""8"" data-max=""8"" value=""bt"">BT +975</option> <option data-code=""+267"" data-min=""8"" data-max=""8"" value=""bw"">BW +267</option> <option data-code=""+375"" data-min=""9"" data-max=""9"" value=""by"">BY +375</option> <option data-code=""+501"" data-min=""7"" data-max=""7"" value=""bz"">BZ +501</option> <option data-code=""+243"" data-min=""9"" data-max=""9"" value=""cd"">CD +243</option> <option data-code=""+236"" data-min=""8"" data-max=""8"" value=""cf"">CF +236</option> <option data-code=""+242"" data-min=""9"" data-max=""9"" value=""cg"">CG +242</option> <option data-code=""+41"" data-min=""9"" data-max=""9"" value=""ch"">CH +41</option> <option data-code=""+225"" data-min=""8"" data-max=""8"" value=""ci"">CI +225</option> <option data-code=""+682"" data-min=""5"" data-max=""5"" value=""ck"">CK +682</option> <option data-code=""+56"" data-min=""9"" data-max=""9"" value=""cl"">CL +56</option> <option data-code=""+237"" data-min=""8"" data-max=""8"" value=""cm"">CM +237</option> <option data-code=""+86"" data-min=""11"" data-max=""11"" value=""cn"">CN +86</option> <option data-code=""+57"" data-min=""10"" data-max=""10"" value=""co"">CO +57</option> <option data-code=""+506"" data-min=""8"" data-max=""8"" value=""cr"">CR +506</option> <option data-code=""+53"" data-min=""8"" data-max=""8"" value=""cu"">CU +53</option> <option data-code=""+238"" data-min=""7"" data-max=""7"" value=""cv"">CV +238</option> <option data-code=""+599"" data-min=""7"" data-max=""7"" value=""cw"">CW +599</option> <option data-code=""+357"" data-min=""8"" data-max=""8"" value=""cy"">CY +357</option> <option data-code=""+420"" data-min=""9"" data-max=""9"" value=""cz"">CZ +420</option> <option data-code=""+49"" data-min=""11"" data-max=""11"" value=""de"">DE +49</option> <option data-code=""+253"" data-min=""8"" data-max=""8"" value=""dj"">DJ +253</option> <option data-code=""+45"" data-min=""8"" data-max=""8"" value=""dk"">DK +45</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""dm"">DM +1</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""do"">DO +1</option> <option data-code=""+213"" data-min=""9"" data-max=""9"" value=""dz"">DZ +213</option> <option data-code=""+593"" data-min=""9"" data-max=""9"" value=""ec"">EC +593</option> <option data-code=""+372"" data-min=""7"" data-max=""8"" value=""ee"">EE +372</option> <option data-code=""+20"" data-min=""10"" data-max=""10"" value=""eg"">EG +20</option> <option data-code=""+291"" data-min=""7"" data-max=""7"" value=""er"">ER +291</option> <option data-code=""+34"" data-min=""9"" data-max=""9"" value=""es"">ES +34</option> <option data-code=""+251"" data-min=""9"" data-max=""9"" value=""et"">ET +251</option> <option data-code=""+47"" data-min=""8"" data-max=""8"" value=""false"">FALSE +47</option> <option data-code=""+358"" data-min=""9"" data-max=""9"" value=""fi"">FI +358</option> <option data-code=""+679"" data-min=""7"" data-max=""7"" value=""fj"">FJ +679</option> <option data-code=""+500"" data-min=""5"" data-max=""5"" value=""fk"">FK +500</option> <option data-code=""+691"" data-min=""7"" data-max=""7"" value=""fm"">FM +691</option> <option data-code=""+298"" data-min=""6"" data-max=""6"" value=""fo"">FO +298</option> <option data-code=""+33"" data-min=""9"" data-max=""9"" value=""fr"">FR +33</option> <option data-code=""+241"" data-min=""7"" data-max=""7"" value=""ga"">GA +241</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""gd"">GD +1</option> <option data-code=""+995"" data-min=""9"" data-max=""9"" value=""ge"">GE +995</option> <option data-code=""+594"" data-min=""9"" data-max=""9"" value=""gf"">GF +594</option> <option data-code=""+233"" data-min=""9"" data-max=""9"" value=""gh"">GH +233</option> <option data-code=""+350"" data-min=""8"" data-max=""8"" value=""gi"">GI +350</option> <option data-code=""+299"" data-min=""6"" data-max=""6"" value=""gl"">GL +299</option> <option data-code=""+220"" data-min=""7"" data-max=""7"" value=""gm"">GM +220</option> <option data-code=""+224"" data-min=""8"" data-max=""8"" value=""gn"">GN +224</option> <option data-code=""+240"" data-min=""9"" data-max=""9"" value=""gq"">GQ +240</option> <option data-code=""+30"" data-min=""10"" data-max=""10"" value=""gr"">GR +30</option> <option data-code=""+502"" data-min=""8"" data-max=""8"" value=""gt"">GT +502</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""gu"">GU +1</option> <option data-code=""+245"" data-min=""7"" data-max=""7"" value=""gw"">GW +245</option> <option data-code=""+592"" data-min=""7"" data-max=""7"" value=""gy"">GY +592</option> <option data-code=""+852"" data-min=""8"" data-max=""8"" value=""hk"">HK +852</option> <option data-code=""+504"" data-min=""8"" data-max=""8"" value=""hn"">HN +504</option> <option data-code=""+385"" data-min=""8"" data-max=""8"" value=""hr"">HR +385</option> <option data-code=""+509"" data-min=""8"" data-max=""8"" value=""ht"">HT +509</option> <option data-code=""+36"" data-min=""9"" data-max=""9"" value=""hu"">HU +36</option> <option data-code=""+62"" data-min=""10"" data-max=""11"" value=""id"">ID +62</option> <option data-code=""+353"" data-min=""9"" data-max=""9"" value=""ie"">IE +353</option> <option data-code=""+972"" data-min=""9"" data-max=""9"" value=""il"">IL +972</option> <option data-code=""+91"" data-min=""10"" data-max=""10"" value=""in"">IN +91</option> <option data-code=""+246"" data-min=""7"" data-max=""7"" value=""io"">IO +246</option> <option data-code=""+964"" data-min=""10"" data-max=""10"" value=""iq"">IQ +964</option> <option data-code=""+98"" data-min=""10"" data-max=""10"" value=""ir"">IR +98</option> <option data-code=""+354"" data-min=""7"" data-max=""7"" value=""is"">IS +354</option> <option data-code=""+39"" data-min=""10"" data-max=""10"" value=""it"">IT +39</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""jm"">JM +1</option> <option data-code=""+962"" data-min=""9"" data-max=""9"" value=""jo"">JO +962</option> <option data-code=""+81"" data-min=""10"" data-max=""10"" value=""jp"">JP +81</option> <option data-code=""+254"" data-min=""9"" data-max=""9"" value=""ke"">KE +254</option> <option data-code=""+996"" data-min=""9"" data-max=""9"" value=""kg"">KG +996</option> <option data-code=""+855"" data-min=""8"" data-max=""8"" value=""kh"">KH +855</option> <option data-code=""+686"" data-min=""5"" data-max=""5"" value=""ki"">KI +686</option> <option data-code=""+269"" data-min=""7"" data-max=""7"" value=""km"">KM +269</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""kn"">KN +1</option> <option data-code=""+850"" data-min=""10"" data-max=""10"" value=""kp"">KP +850</option> <option data-code=""+82"" data-min=""10"" data-max=""10"" value=""kr"">KR +82</option> <option data-code=""+965"" data-min=""8"" data-max=""8"" value=""kw"">KW +965</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""ky"">KY +1</option> <option data-code=""+7"" data-min=""10"" data-max=""10"" value=""kz"">KZ +7</option> <option data-code=""+856"" data-min=""10"" data-max=""10"" value=""la"">LA +856</option> <option data-code=""+961"" data-min=""8"" data-max=""8"" value=""lb"">LB +961</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""lc"">LC +1</option> <option data-code=""+423"" data-min=""10"" data-max=""10"" value=""li"">LI +423</option> <option data-code=""+94"" data-min=""9"" data-max=""9"" value=""lk"">LK +94</option> <option data-code=""+231"" data-min=""8"" data-max=""8"" value=""lr"">LR +231</option> <option data-code=""+266"" data-min=""8"" data-max=""8"" value=""ls"">LS +266</option> <option data-code=""+370"" data-min=""8"" data-max=""8"" value=""lt"">LT +370</option> <option data-code=""+352"" data-min=""9"" data-max=""9"" value=""lu"">LU +352</option> <option data-code=""+371"" data-min=""8"" data-max=""8"" value=""lv"">LV +371</option> <option data-code=""+218"" data-min=""8"" data-max=""8"" value=""ly"">LY +218</option> <option data-code=""+212"" data-min=""9"" data-max=""9"" value=""ma"">MA +212</option> <option data-code=""+377"" data-min=""9"" data-max=""9"" value=""mc"">MC +377</option> <option data-code=""+373"" data-min=""8"" data-max=""8"" value=""md"">MD +373</option> <option data-code=""+382"" data-min=""8"" data-max=""8"" value=""me"">ME +382</option> <option data-code=""+261"" data-min=""9"" data-max=""9"" value=""mg"">MG +261</option> <option data-code=""+692"" data-min=""7"" data-max=""7"" value=""mh"">MH +692</option> <option data-code=""+389"" data-min=""8"" data-max=""8"" value=""mk"">MK +389</option> <option data-code=""+223"" data-min=""8"" data-max=""8"" value=""ml"">ML +223</option> <option data-code=""+95"" data-min=""8"" data-max=""8"" value=""mm"">MM +95</option> <option data-code=""+976"" data-min=""8"" data-max=""8"" value=""mn"">MN +976</option> <option data-code=""+853"" data-min=""8"" data-max=""8"" value=""mo"">MO +853</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""mp"">MP +1</option> <option data-code=""+596"" data-min=""9"" data-max=""9"" value=""mq"">MQ +596</option> <option data-code=""+222"" data-min=""8"" data-max=""8"" value=""mr"">MR +222</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""ms"">MS +1</option> <option data-code=""+356"" data-min=""8"" data-max=""8"" value=""mt"">MT +356</option> <option data-code=""+230"" data-min=""7"" data-max=""7"" value=""mu"">MU +230</option> <option data-code=""+960"" data-min=""7"" data-max=""7"" value=""mv"">MV +960</option> <option data-code=""+265"" data-min=""7"" data-max=""7"" value=""mw"">MW +265</option> <option data-code=""+52"" data-min=""10"" data-max=""10"" value=""mx"">MX +52</option> <option data-code=""+60"" data-min=""9"" data-max=""9"" value=""my"">MY +60</option> <option data-code=""+258"" data-min=""8"" data-max=""8"" value=""mz"">MZ +258</option> <option data-code=""+264"" data-min=""9"" data-max=""9"" value=""na"">NA +264</option> <option data-code=""+687"" data-min=""6"" data-max=""6"" value=""nc"">NC +687</option> <option data-code=""+227"" data-min=""8"" data-max=""8"" value=""ne"">NE +227</option> <option data-code=""+672"" data-min=""6"" data-max=""6"" value=""nf"">NF +672</option> <option data-code=""+234"" data-min=""10"" data-max=""10"" value=""ng"">NG +234</option> <option data-code=""+505"" data-min=""8"" data-max=""8"" value=""ni"">NI +505</option> <option data-code=""+31"" data-min=""9"" data-max=""9"" value=""nl"">NL +31</option> <option data-code=""+47"" data-min=""8"" data-max=""8"" value=""no"">NO +47</option> <option data-code=""+977"" data-min=""8"" data-max=""8"" value=""np"">NP +977</option> <option data-code=""+674"" data-min=""7"" data-max=""7"" value=""nr"">NR +674</option> <option data-code=""+683"" data-min=""4"" data-max=""4"" value=""nu"">NU +683</option> <option data-code=""+64"" data-min=""9"" data-max=""9"" value=""nz"">NZ +64</option> <option data-code=""+968"" data-min=""8"" data-max=""8"" value=""om"">OM +968</option> <option data-code=""+507"" data-min=""7"" data-max=""7"" value=""pa"">PA +507</option> <option data-code=""+51"" data-min=""9"" data-max=""9"" value=""pe"">PE +51</option> <option data-code=""+689"" data-min=""6"" data-max=""6"" value=""pf"">PF +689</option> <option data-code=""+675"" data-min=""8"" data-max=""8"" value=""pg"">PG +675</option> <option data-code=""+63"" data-min=""10"" data-max=""10"" value=""ph"">PH +63</option> <option data-code=""+92"" data-min=""10"" data-max=""10"" value=""pk"">PK +92</option> <option data-code=""+48"" data-min=""9"" data-max=""9"" value=""pl"">PL +48</option> <option data-code=""+970"" data-min=""9"" data-max=""9"" value=""ps"">PS +970</option> <option data-code=""+351"" data-min=""9"" data-max=""9"" value=""pt"">PT +351</option> <option data-code=""+680"" data-min=""7"" data-max=""7"" value=""pw"">PW +680</option> <option data-code=""+595"" data-min=""9"" data-max=""9"" value=""py"">PY +595</option> <option data-code=""+974"" data-min=""8"" data-max=""8"" value=""qa"">QA +974</option> <option data-code=""+262"" data-min=""9"" data-max=""9"" value=""re"">RE +262</option> <option data-code=""+40"" data-min=""9"" data-max=""9"" value=""ro"">RO +40</option> <option data-code=""+381"" data-min=""9"" data-max=""9"" value=""rs"">RS +381</option> <option data-code=""+7"" data-min=""10"" data-max=""10"" value=""ru"">RU +7</option> <option data-code=""+250"" data-min=""9"" data-max=""9"" value=""rw"">RW +250</option> <option data-code=""+966"" data-min=""9"" data-max=""9"" value=""sa"">SA +966</option> <option data-code=""+677"" data-min=""7"" data-max=""7"" value=""sb"">SB +677</option> <option data-code=""+248"" data-min=""7"" data-max=""7"" value=""sc"">SC +248</option> <option data-code=""+249"" data-min=""9"" data-max=""9"" value=""sd"">SD +249</option> <option data-code=""+46"" data-min=""9"" data-max=""9"" value=""se"">SE +46</option> <option data-code=""+65"" data-min=""8"" data-max=""8"" value=""sg"">SG +65</option> <option data-code=""+290"" data-min=""4"" data-max=""4"" value=""sh"">SH +290</option> <option data-code=""+386"" data-min=""8"" data-max=""8"" value=""si"">SI +386</option> <option data-code=""+421"" data-min=""9"" data-max=""9"" value=""sk"">SK +421</option> <option data-code=""+232"" data-min=""8"" data-max=""8"" value=""sl"">SL +232</option> <option data-code=""+378"" data-min=""10"" data-max=""10"" value=""sm"">SM +378</option> <option data-code=""+221"" data-min=""9"" data-max=""9"" value=""sn"">SN +221</option> <option data-code=""+252"" data-min=""8"" data-max=""8"" value=""so"">SO +252</option> <option data-code=""+597"" data-min=""7"" data-max=""7"" value=""sr"">SR +597</option> <option data-code=""+211"" data-min=""9"" data-max=""9"" value=""ss"">SS +211</option> <option data-code=""+239"" data-min=""7"" data-max=""7"" value=""st"">ST +239</option> <option data-code=""+503"" data-min=""8"" data-max=""8"" value=""sv"">SV +503</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""sx"">SX +1</option> <option data-code=""+963"" data-min=""9"" data-max=""9"" value=""sy"">SY +963</option> <option data-code=""+268"" data-min=""8"" data-max=""8"" value=""sz"">SZ +268</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""tc"">TC +1</option> <option data-code=""+235"" data-min=""8"" data-max=""8"" value=""td"">TD +235</option> <option data-code=""+228"" data-min=""8"" data-max=""8"" value=""tg"">TG +228</option> <option data-code=""+66"" data-min=""9"" data-max=""9"" value=""th"">TH +66</option> <option data-code=""+992"" data-min=""9"" data-max=""9"" value=""tj"">TJ +992</option> <option data-code=""+690"" data-min=""4"" data-max=""4"" value=""tk"">TK +690</option> <option data-code=""+670"" data-min=""7"" data-max=""7"" value=""tl"">TL +670</option> <option data-code=""+993"" data-min=""8"" data-max=""8"" value=""tm"">TM +993</option> <option data-code=""+216"" data-min=""8"" data-max=""8"" value=""tn"">TN +216</option> <option data-code=""+676"" data-min=""5"" data-max=""5"" value=""to"">TO +676</option> <option data-code=""+90"" data-min=""10"" data-max=""10"" value=""tr"">TR +90</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""tt"">TT +1</option> <option data-code=""+688"" data-min=""6"" data-max=""6"" value=""tv"">TV +688</option> <option data-code=""+886"" data-min=""9"" data-max=""9"" value=""tw"">TW +886</option> <option data-code=""+255"" data-min=""9"" data-max=""9"" value=""tz"">TZ +255</option> <option data-code=""+380"" data-min=""9"" data-max=""9"" value=""ua"">UA +380</option> <option data-code=""+256"" data-min=""9"" data-max=""9"" value=""ug"">UG +256</option> <option data-code=""+44"" data-min=""10"" data-max=""10"" value=""uk"">UK +44</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""us"">US +1</option> <option data-code=""+598"" data-min=""8"" data-max=""8"" value=""uy"">UY +598</option> <option data-code=""+998"" data-min=""9"" data-max=""9"" value=""uz"">UZ +998</option> <option data-code=""+39"" data-min=""9"" data-max=""9"" value=""va"">VA +39</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""vc"">VC +1</option> <option data-code=""+58"" data-min=""10"" data-max=""10"" value=""ve"">VE +58</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""vg"">VG +1</option> <option data-code=""+1"" data-min=""10"" data-max=""10"" value=""vi"">VI +1</option> <option data-code=""+84"" data-min=""9"" data-max=""9"" value=""vn"">VN +84</option> <option data-code=""+678"" data-min=""7"" data-max=""7"" value=""vu"">VU +678</option> <option data-code=""+681"" data-min=""6"" data-max=""6"" value=""wf"">WF +681</option> <option data-code=""+685"" data-min=""6"" data-max=""6"" value=""ws"">WS +685</option> <option data-code=""+967"" data-min=""9"" data-max=""9"" value=""ye"">YE +967</option> <option data-code=""+27"" data-min=""9"" data-max=""9"" value=""za"">ZA +27</option> <option data-code=""+260"" data-min=""9"" data-max=""9"" value=""zm"">ZM +260</option> <option data-code=""+263"" data-min=""7"" data-max=""7"" value=""zw"">ZW +263</option> </select>
         <input type=""tel"" name=""phone"" id=""phone"" class=""phone"" placeholder=""Ваш телефон"" style=""width: 150px; margin: 0 5px; padding: 8px 10px; "" required minlength=""10"" maxlength=""10"" pattern=""\d+"">
         <a class=""button"" href=""sms:+79154445444"" id=""submit-sms"" target=""_blank"">→</a> 
         <!--                                 <div style=""width: 100%; text-align: left;""><input id=""accept-offer"" name=""IDToken4"" type=""checkbox"" style=""-webkit-appearance: checkbox; width: auto;"" />Я принимаю <a href=""https://login.wi-fi.ru/docs/offers/offer_auth.pdf"">условия оферты</a></div>                          --> 
         <input type=""hidden"" name=""IDButton"" id=""IDButton"" value=""Send""> 
         <p class=""small""> Введите Ваш номер и подтвердите идентификацию, отправив СМС с текстом ""Да"" на номер +7 (915) 444-5-444. <a href=""https://login.wi-fi.ru/vmetro/faq/identification-in-network?client_mac=50-2e-5c-50-72-3c&amp;lang=ru&amp;service=coa"">Подробнее</a> </p> 
         <p class=""small""> <a href=""https://login.wi-fi.ru/docs/offers/offer_auth.pdf"">Прохождение идентификации является фактом принятия оферты</a> </p> 
        </div> 
        <input type=""hidden"" name=""csrf.sign"" value=""b6706722f5e3b08dbfe0e46b8ffe7e7a22d16bf92f1efc25a576479fa7c0a7aa"">
        <input type=""hidden"" name=""csrf.ts"" value=""1456240331342"">
       </form> 
      </div> 
     </div> 
    </div>   
    <div id=""root_footer""></div> 
   </div> 
  </div> 
  <div id=""footer""> 
   <div class=""row"">
    <a class=""button"" href=""https://login.wi-fi.ru/vmetro/faq?lang=ru&amp;client_mac=50-2e-5c-50-72-3c&amp;service=coa"">Поддержка</a>
   </div> 
   <div class=""row sign"">
    <span class=""copyright"">©</span> 
    <span>2016 · АО «МаксимаТелеком»</span>
   </div> 
  </div>   
</body>
</html>
```
"
mosmetro-android/mosmetro-android,closed,"Подключение успешно проходит, но авторизация сбрасывается",[],"В некоторых случаях авторизация сбрасывается через несколько секунд после успешного подключения.

Лог такого подключения:

```
Версия приложения: 1.4-20
> Feb 22, 2016 11:57:20 AM
>> Проверка доступа в интернет
java.io.EOFException
at com.android.okhttp.internal.Util.readAsciiLine(Util.java:318)
at com.android.okhttp.internal.http.RawHeaders.fromBytes(RawHeaders.java:308)
at com.android.okhttp.internal.http.HttpTransport.readResponseHeaders(HttpTransport.java:135)
at com.android.okhttp.internal.http.HttpEngine.readResponse(HttpEngine.java:644)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:347)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:296)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:503)
at pw.thedrhax.httpclient.HttpRequest.connect(HttpRequest.java:116)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:67)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:89)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.isConnected(AuthenticatorStat.java:49)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:98)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:37)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:124)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:110)
at android.os.AsyncTask$2.call(AsyncTask.java:288)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
at java.lang.Thread.run(Thread.java:841)

<< Все проверки пройдены
>> Подключаюсь...
>>> Получение начального перенаправления
<html>
<head>
  <title> Web Authentication Redirect</title>
  <meta http-equiv=""Cache-control"" content=""no-cache"">
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""refresh"" content=""1; URL=http://login.wi-fi.ru/am/UI/Login?rand=W6X74uPO&amp;org=mac&amp;service=coa&amp;client_mac=b4-ef-39-45-3c-77&amp;ForceAuth=true"">
</head>
<body> 
</body>
</html>
http://login.wi-fi.ru/am/UI/Login?rand=W6X74uPO&org=mac&service=coa&client_mac=b4-ef-39-45-3c-77&ForceAuth=true
>>> Получение начальной страницы
<!doctype html>
<html>
<head>
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate"">
  <meta name=""robots"" content=""noindex, nofollow""> 
  <meta charset=""utf-8""> 
  <title></title> 
  <meta http-equiv=""refresh"" content=""6;URL=?rand=W6X74uPO&amp;org=mac&amp;service=coa&amp;client_mac=b4-ef-39-45-3c-77&amp;ForceAuth=true&amp;adbtoken=ec60eb2fd2aa9249424d5a59a21a8e0b"" id=""r1""> 
  <meta name=""referrer"" content=""always""> 
  <meta http-equiv=""Pragma"" content=""no-cache""> 
  <meta http-equiv=""Expires"" content=""-1""> 
  <meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate""> 
  <meta name=""robots"" content=""noindex, nofollow""> 
  <link rel=""icon"" href=""/favicon.ico"" type=""image/x-icon""> 
</head> 
<body> 
  <form id=""submit-form"" method=""post"" action=""https://login.wi-fi.ru/am/UI/Login?rand=W6X74uPO&amp;org=mac&amp;service=coa&amp;client_mac=b4-ef-39-45-3c-77&amp;ForceAuth=true""> 
   <input id=""hash"" type=""hidden"" name=""IDToken1"" value=""ec60eb2fd2aa9249424d5a59a21a8e0b""> 
   <input type=""hidden"" name=""csrf.sign"" value=""c8a1ae1a72ace20f89b691c82c3715fb0136145572ffc9bdf46d981318f05459"">
   <input type=""hidden"" name=""csrf.ts"" value=""1456131437711"">
  </form>  
  <img src=""http://ads.adfox.ru/220463/getCode?p1=buhvd&amp;p2=v&amp;pe=b&amp;pfc=bezbz&amp;pfb=dksmt&amp;pr=eslgyih"" onload=""load()"" onerror=""error()"" width=""1"" height=""1"" style=""visibility:hidden"">   
</body>
</html>
IDToken1=ec60eb2fd2aa9249424d5a59a21a8e0b&csrf.sign=c8a1ae1a72ace20f89b691c82c3715fb0136145572ffc9bdf46d981318f05459&csrf.ts=1456131437711
>>> Получение страницы авторизации
<!doctype html>
<html class=""no-js"">
<head>
  <meta http-equiv=""Pragma"" content=""no-cache"">
  <meta http-equiv=""Expires"" content=""-1"">
  <meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate"">
  <meta name=""robots"" content=""noindex, nofollow""> 
  <meta charset=""utf-8""> 
  <title>Авторизация Wi-Fi. Войти в Интернет</title> 
  <meta name=""referrer"" content=""always"">  
  <link rel=""dns-prefetch"" href=""//static.wi-fi.ru""> 
  <link rel=""dns-prefetch"" href=""//static0.wi-fi.ru""> 
  <link rel=""dns-prefetch"" href=""//creative.wi-fi.ru"">       
  <meta content=""width=device-width, initial-scale=1.0, user-scalable=no"" name=""viewport""> 
  <meta content=""ЗАО «МаксимаТелеком»"" name=""author""> 
  <link rel=""icon"" href=""/am/favicon.ico"" type=""image/x-icon""> 
  <link rel=""shortcut icon"" href=""/am/favicon.ico"" type=""image/x-icon""> 
</head> 
<body> 
  <ul id=""header"" class=""nav""> 
   <li class=""nav__i nav__i_agreement"">
    <!-- 
          --><a href=""http://login.wi-fi.ru/docs/offers/offer_auth.pdf"" class=""nav__link"">Нажимая кнопку «Войти в Интернет», вы принимаете условия оферты</a></li> 
   <li class=""nav__i"">
    <!-- 
          --><a href=""http://login.wi-fi.ru/vmetro/faq?lang=ru&amp;client_mac=b4-ef-39-45-3c-77"" class=""nav__link"">Поддержка</a> </li> 
   <li class=""nav__i nav__i_lang"">
    <!-- 
          --><a class=""nav__link"" href=""?rand=W6X74uPO&amp;org=mac&amp;service=coa&amp;client_mac=b4-ef-39-45-3c-77&amp;ForceAuth=true&amp;lang=en""> <span class=""flag-icon flag-icon-uk""></span> English </a> </li> 
  </ul> 
  <div id=""root""> 
   <div id=""content"">
    <!-- 
        -->
    <h1 class=""welcome""> Добро пожаловать в Wi‑Fi зону Московского Метрополитена </h1> 
   </div> 
   <div id=""footer""> 
    <form id=""auth-form"" autocomplete=""off"" method=""post""> 
     <input id=""promogoto"" data-test=""test"" name=""promogoto"" type=""hidden"" value=""""> 
     <input id=""IDButton"" name=""IDButton"" type=""hidden"" value=""Confirm""> 
     <button id=""i-btn-default"" type=""submit"" class=""btn"">Войти в Интернет</button> 
     <input type=""hidden"" name=""csrf.sign"" value=""adbc57799bfad9a7e48fdba5b537fff66eb582d68501889e477c1c8c765f988c"">
     <input type=""hidden"" name=""csrf.ts"" value=""1456131437826"">
    </form> 
    <a id=""join-internet"" class=""btn"" href=""#"">Войти в Интернет</a> 
    <a id=""premium"" href=""https://login.wi-fi.ru/am/UI/Login?org=mac&amp;service=seamless&amp;goto=https%3A%2F%2Fcabinet.wi-fi.ru%2Fpremium"" class=""btn btn_premium"">Отключить авторизацию</a> 
   </div> 
  </div> 
  <div id=""loader"" class=""l-loader"">
   <div class=""loader""></div>
  </div> 
  <div id=""adfox-events""></div>     
</body>
</html>
promogoto=&IDButton=Confirm&csrf.sign=adbc57799bfad9a7e48fdba5b537fff66eb582d68501889e477c1c8c765f988c&csrf.ts=1456131437826
>>> Отправка формы авторизации
<html>
<head></head>
<body>
  You are being 
  <a href=""https://login.wi-fi.ru/am/UI/Login?org=mac&amp;service=seamless&amp;goto=http%3A%2F%2Fwi-fi.ru%2F"">redirected</a>. 
</body>
</html>
>> Проверка доступа в интернет
<< Соединение успешно установлено :3
< Feb 22, 2016 11:57:21 AM
```
"
mosmetro-android/mosmetro-android,closed,Уведомление об успехе не исчезает при отключении,"[Label(name=""bug"")]","Поступило сообщение, что уведомление об успехе не удаляется при отключении от Wi-Fi. Ошибка не воспроизводится у меня, поэтому придется действовать наугад.
"
mosmetro-android/mosmetro-android,closed,Удаление JavaScript из лога,"[Label(name=""enhancement"")]","Огромные скрипты, которые содержатся в страницах авторизации, составляют больше половины присылаемых отчетов. Необходимо вырезать вставки `<script>`, потому что они не нужны для решения проблем.
"
mosmetro-android/mosmetro-android,closed,Изменение алгоритма (вторая половина февраля 2016),"[Label(name=""bug"")]","В некоторых случаях, особенно при высокой нагрузке на сеть, появляется странный эффект, когда сервер в ответ на любой запрос отвечает одной и той же ошибкой. Скорее всего, это ошибка сервера, однако стоит убедиться в этом.

```
Версия приложения: 1.3-18
> 16 Feb 2016 5:16:04 pm
>> Проверка доступа в интернет
java.io.EOFException
at com.android.okio.RealBufferedSource.readUtf8LineStrict(RealBufferedSource.java:95)
at com.android.okhttp.internal.http.HttpConnection.readResponse(HttpConnection.java:179)
at com.android.okhttp.internal.http.HttpTransport.readResponseHeaders(HttpTransport.java:101)
at com.android.okhttp.internal.http.HttpEngine.readResponse(HttpEngine.java:628)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:388)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:332)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:500)
at pw.thedrhax.httpclient.HttpRequest.connect(HttpRequest.java:116)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:67)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:89)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.isConnected(AuthenticatorStat.java:49)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:41)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:37)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:113)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:100)
at android.os.AsyncTask$2.call(AsyncTask.java:292)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
at java.lang.Thread.run(Thread.java:818)

<< Все проверки пройдены
>> Подключаюсь...
>>> Получение перенаправления на страницу авторизации
<HTML><HEAD><TITLE> Web Authentication Redirect</TITLE><META http-equiv=""Cache-control"" content=""no-cache""><META http-equiv=""Pragma"" content=""no-cache""><META http-equiv=""Expires"" content=""-1""><META http-equiv=""refresh"" content=""1; URL=http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""></HEAD></HTML>

https://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true
>>> Получение страницы авторизации
<html><head><meta http-equiv=""Pragma"" content=""no-cache""><meta http-equiv=""Expires"" content=""-1""><meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate""><meta name=""robots"" content=""noindex, nofollow"" /><meta http-equiv=""Content-Type"" content=""text/html;charset=utf-8""><noscript><meta http-equiv=""refresh"" content=""1; url=http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""></noscript><title>Переадресация</title></head> 
<body><script id=""redirect"" type=""text/javascript""> 
<!-- 
location.href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""; 
//--> 
</script><a href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true"">Нажмите на ссылку, если переход не произошел автоматически</a></body></html>

>>> Отправка формы авторизации
<html><head><meta http-equiv=""Pragma"" content=""no-cache""><meta http-equiv=""Expires"" content=""-1""><meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate""><meta name=""robots"" content=""noindex, nofollow"" /><meta http-equiv=""Content-Type"" content=""text/html;charset=utf-8""><noscript><meta http-equiv=""refresh"" content=""1; url=http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""></noscript><title>Переадресация</title></head> 
<body><script id=""redirect"" type=""text/javascript""> 
<!-- 
location.href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""; 
//--> 
</script><a href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true"">Нажмите на ссылку, если переход не произошел автоматически</a></body></html>

>>> Отправка второй формы авторизации
<html><head><meta http-equiv=""Pragma"" content=""no-cache""><meta http-equiv=""Expires"" content=""-1""><meta http-equiv=""Cache-Control"" content=""no-cache,no-store,must-revalidate""><meta name=""robots"" content=""noindex, nofollow"" /><meta http-equiv=""Content-Type"" content=""text/html;charset=utf-8""><noscript><meta http-equiv=""refresh"" content=""1; url=http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""></noscript><title>Переадресация</title></head> 
<body><script id=""redirect"" type=""text/javascript""> 
<!-- 
location.href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true""; 
//--> 
</script><a href=""http://login.wi-fi.ru/am/UI/Login?rand=ftExOq1f&org=mac&service=coa&client_mac=d0-22-be-cf-bc-64&ForceAuth=true"">Нажмите на ссылку, если переход не произошел автоматически</a></body></html>

>> Проверка доступа в интернет
java.io.EOFException
at com.android.okio.RealBufferedSource.readUtf8LineStrict(RealBufferedSource.java:95)
at com.android.okhttp.internal.http.HttpConnection.readResponse(HttpConnection.java:179)
at com.android.okhttp.internal.http.HttpTransport.readResponseHeaders(HttpTransport.java:101)
at com.android.okhttp.internal.http.HttpEngine.readResponse(HttpEngine.java:628)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.execute(HttpURLConnectionImpl.java:388)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponse(HttpURLConnectionImpl.java:332)
at com.android.okhttp.internal.http.HttpURLConnectionImpl.getResponseCode(HttpURLConnectionImpl.java:500)
at pw.thedrhax.httpclient.HttpRequest.connect(HttpRequest.java:116)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:67)
at pw.thedrhax.httpclient.HttpClient.navigate(HttpClient.java:89)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.isConnected(AuthenticatorStat.java:49)
at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:188)
at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:37)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:113)
at pw.thedrhax.mosmetro.activities.DebugActivity$AuthTask.doInBackground(DebugActivity.java:100)
at android.os.AsyncTask$2.call(AsyncTask.java:292)
at java.util.concurrent.FutureTask.run(FutureTask.java:237)
at android.os.AsyncTask$SerialExecutor$1.run(AsyncTask.java:231)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
at java.lang.Thread.run(Thread.java:818)

<< Ошибка: доступ в интернет отсутствует
```
"
mosmetro-android/mosmetro-android,closed,Проверка соединения с интернетом путем поиска перенаправления,"[Label(name=""enhancement"")]","Поиск перенаправления на страницу авторизации оказался довольно действенным методом в python-версии, поэтому можно избавиться от зависимости от сторонних серверов.

Подробнее об алгоритме проверки можно узнать из этого коммита: https://github.com/TheDrHax/mosmetro-python/commit/41f6faf6463fe90f98829d7290e027fdb3c1fed7
"
mosmetro-android/mosmetro-android,closed,Отчеты Google Play: NullPointerException во время проверки регулярного выражения,"[Label(name=""bug"")]","Версия приложения: 16
Версия Android: 4.4

```
java.lang.NullPointerException
    at java.util.regex.Matcher.reset(Matcher.java:177)
    at java.util.regex.Matcher.<init>(Matcher.java:90)
    at java.util.regex.Pattern.matcher(Pattern.java:297)

    at pw.thedrhax.mosmetro.authenticator.Authenticator.connect(Authenticator.java:72)
    at pw.thedrhax.mosmetro.authenticator.AuthenticatorStat.connect(AuthenticatorStat.java:41)
    at pw.thedrhax.mosmetro.services.ConnectionService.connect(ConnectionService.java:123)
    at pw.thedrhax.mosmetro.services.ConnectionService.onHandleIntent(ConnectionService.java:144)

    at android.app.IntentService$ServiceHandler.handleMessage(IntentService.java:65)
    at android.os.Handler.dispatchMessage(Handler.java:102)
    at android.os.Looper.loop(Looper.java:136)
    at android.os.HandlerThread.run(HandlerThread.java:61)
```
"
mosmetro-android/mosmetro-android,closed,Обход определения Captive Portal в Android,"[Label(name=""enhancement"")]","Недавно в сеть MosMetro_Free был добавлен Captive Portal, который заставляет устройства действовать следующим образом:
- Некоторые браузеры (например, UC Browser или даже сама система Android) выводят уведомление ""Подключиться к сети"", которое не исчезает самостоятельно после подключения
- Некоторые браузеры **сами** открывают страницу с рекламой и кнопкой авторизации
- На значке Wi-Fi появляется восклицательный знак, который напрягает пользователей и некоторые приложения
- Устройство отказывается переподключаться к этой сети самостоятельно, а иногда и **отключается** через некоторое время
  При этом сам Captive Portal не влияет на приложение (по крайней мере, такого не было замечено).

Существует [способ](http://android.stackexchange.com/questions/100657/how-to-disable-captive-portal-detection-how-to-remove-exclamation-mark-on-wi-fi) отключения этой функции, но он требует права root и работу с терминалом.

Варианты решения проблемы:
- Найти способ отключить эту функцию без прав root из приложения
- Добавить функцию, которая требует права root и отключает эту проверку
"
mosmetro-android/mosmetro-android,closed,"Уведомление об успехе показывается, но подключения нет","[Label(name=""bug"")]","Поступило несколько сообщений о том, что при подключении к сети высвечивается уведомление об успехе, но подключение не происходит.

При этом ручное подключение работает нормально. В том числе, при переподключении к той же сети алгоритм может сработать нормально.
"
mosmetro-android/mosmetro-android,closed,Очередное изменение алгоритма (8.02.2016),[],"Возможно, что 8 февраля алгоритм снова изменился.

Статистика это не подтверждает, однако поступило несколько сообщений и я сам столкнулся с аналогичной ошибкой, но не успел разобраться.
![screenshot_08 02 2016-21 07 50](https://cloud.githubusercontent.com/assets/6968908/12894489/0c01b0a2-cea8-11e5-8508-ebb686e5eab8.png)
Судя по графику, это могла быть временная неполадка, однако стоит еще раз убедиться в полной работоспособности алгоритма.

[Скриншот (от одного из пользователей)](https://cloud.githubusercontent.com/assets/6968908/12894455/e0d56b6c-cea7-11e5-80dd-2310f8de7f86.png)
"
mosmetro-android/mosmetro-android,closed,Отправка отчета по другим каналам,"[Label(name=""enhancement"")]","Так как:
- не всегда возможно отправить отчет сразу (интернет отсутствует),
- свернутое приложение может быть выгружено из памяти (лог удалится),
- при открытии нового лога старый перезапишется,

необходимо сделать следующее:
- удалить отправку отчетов на мой сервер (так как нет обратной связи)
  - добавить версию приложения в стандартный лог (AuthenticatorStat)
  - класс SendReportTask, а также метод report() в AuthenticatorStat больше не нужны
- добавить отправку отчета через E-mail (можно сохранить черновик письма)
"
mosmetro-android/mosmetro-android,closed,Android 4.0 - 4.1: Страница авторизации не получена,"[Label(name=""bug"")]","Поступило сообщение об ошибке, возникающей в HttpRequest. Раньше в нем использовался хак, который позволял считать ответ сервера несмотря на ошибку 401, которую он всегда возвращает при получении страницы авторизации. Возможно, что теперь сервер не дает считать ответ, но это требует подтверждения.

Версия Android: 4.0.4
Лог подключения: [log.txt](https://github.com/TheDrHax/mosmetro-android/files/117765/log.txt)
"
mosmetro-android/mosmetro-android,closed,Уведомление об успехе не пропадает в некоторых случаях,"[Label(name=""bug"")]","Если после успешного подключения отключить автоматическое подключение в настройках, то при отсоединении от Wi-Fi уведомление не удаляется.
"
mosmetro-android/mosmetro-android,closed,Авторизация перестала работать,"[Label(name=""bug"")]","По многочисленным сообщениям, начиная с 16 часов 2 февраля 2016, авторизация в метро перестала работать.

График успешных подключений подтверждает проблему:
![screenshot_03 02 2016-01 48 09](https://cloud.githubusercontent.com/assets/6968908/12767080/32ff87c2-ca18-11e5-9cff-9565c4f2d41f.png)

Возможно, изменение алгоритма авторизации со стороны метро.
"
